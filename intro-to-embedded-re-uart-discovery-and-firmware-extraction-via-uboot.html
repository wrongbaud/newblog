<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>Intro to Embedded RE: UART Discovery and Firmware Extraction via UBoot - VoidStar Security Blog</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">



<link rel="canonical" href="/intro-to-embedded-re-uart-discovery-and-firmware-extraction-via-uboot.html">

        <meta name="author" content=""Matthew Alt"" />
        <meta name="keywords" content="hardware,uart,uboot" />
        <meta name="description" content="This blog entry aims to familiarize readers with locating an active UART on a target system, how to approach a UBoot console, and ultimately how to leverage both of these components to extract the flash memory from our target. After reading this, readers will be familiar with the screen utility the depthcharge python3 libraries." />

        <meta property="og:site_name" content="VoidStar Security Blog" />
        <meta property="og:type" content="article"/>
        <meta property="og:title" content="Intro to Embedded RE: UART Discovery and Firmware Extraction via UBoot"/>
        <meta property="og:url" content="/intro-to-embedded-re-uart-discovery-and-firmware-extraction-via-uboot.html"/>
        <meta property="og:description" content="This blog entry aims to familiarize readers with locating an active UART on a target system, how to approach a UBoot console, and ultimately how to leverage both of these components to extract the flash memory from our target. After reading this, readers will be familiar with the screen utility the depthcharge python3 libraries."/>
        <meta property="article:published_time" content="2022-01-27" />
            <meta property="article:section" content="Hardware" />
            <meta property="article:tag" content="hardware" />
            <meta property="article:tag" content="uart" />
            <meta property="article:tag" content="uboot" />
            <meta property="article:author" content=""Matthew Alt"" />



    <!-- Bootstrap -->
        <link rel="stylesheet" href="/theme/css/bootstrap.spacelab.min.css" type="text/css"/>
    <link href="/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="/theme/css/pygments/native.css" rel="stylesheet">
    <link rel="stylesheet" href="/theme/css/style.css" type="text/css"/>

        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="VoidStar Security Blog ATOM Feed"/>

        <link href="/feeds/hardware.atom.xml" type="application/atom+xml" rel="alternate"
              title="VoidStar Security Blog Hardware ATOM Feed"/>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <a href="/" class="navbar-brand">
VoidStar Security Blog            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
            </ul>
            <ul class="nav navbar-nav navbar-right">
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->

<!-- Banner -->
<!-- End Banner -->

<!-- Content Container -->
<div class="container">
    <div class="row">
        <div class="col-sm-9 col-sm-push-3">
    <section id="content">
        <article>
            <header class="page-header">
                <h1>
                    <a href="/intro-to-embedded-re-uart-discovery-and-firmware-extraction-via-uboot.html"
                       rel="bookmark"
                       title="Permalink to Intro to Embedded RE: UART Discovery and Firmware Extraction via UBoot">
                        Intro to Embedded RE: UART Discovery and Firmware Extraction via UBoot
                    </a>
                </h1>
            </header>
            <div class="entry-content">
                <div class="panel">
                    <div class="panel-body">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2022-01-27T00:00:00-07:00"> Thu 27 January 2022</time>
    </span>


            <span class="label label-default">By</span>
            <a href="/author/matthew-alt.html"><i class="fa fa-user"></i> "Matthew Alt"</a>

        <span class="label label-default">Category</span>
        <a href="/category/hardware.html">Hardware</a>


<span class="label label-default">Tags</span>
	<a href="/tag/hardware.html">hardware</a>
        /
	<a href="/tag/uart.html">uart</a>
        /
	<a href="/tag/uboot.html">uboot</a>
    
</footer><!-- /.post-info -->                    </div>
                </div>
                <hr>
<h1>Intro to Embedded RE: UART Discovery and Firmware Extraction via UBoot</h1>
<h1>Previous Entries</h1>
<ul>
<li>Part 1: <a href="https://voidstarsec.com/blog/intro-to-embedded-part-1">Tools / Series Overview</a></li>
<li>Part 2: <a href="https://voidstarsec.com/blog/ghidra-dev-environment">Building a Development Environment for Ghidra</a></li>
</ul>
<h1>Overview</h1>
<p>Welcome to the third post in our Intro to Embedded RE series. This post will be focused on UART, UBoot, and USB using the Arcade 1UP Marvel countertop cabinet as a target. The Arcade 1Up series of cabinets are an affordable way to set up an arcade in your home. Since the launch of these cabinets, there have been plenty of <a href="https://arcademodup.com/product/amumodkit/">mods</a> that demonstrate how to replace the internal components of the cabinet to run generic MAME software. This post will look at the stock hardware and determine how to extract the firmware. </p>
<p><img alt="Cabinet Pic" src="https://voidstarsec.com/blog/assets/images/msh.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<h1>Goals</h1>
<p>With this post, we will review the following:</p>
<ul>
<li>Performing a teardown of an embedded system</li>
<li>Component identification via IC markings</li>
<li>Measuring header voltages with a multimeter</li>
<li>Logic analyzer usage and setup</li>
<li>UBoot analysis and review</li>
<li>Scripting UBoot interactions with <a href="https://depthcharge.readthedocs.io/en/latest/">depthcharge</a></li>
</ul>
<p>This blog entry aims to familiarize readers with locating an active UART on a target system, how to approach a UBoot console, and ultimately how to leverage both of these components to extract the flash memory from our target. After reading this, readers will be familiar with the <code>screen</code> utility the <code>depthcharge</code> python3 libraries.</p>
<h1>Hardware Overview</h1>
<p>When looking at a new target, one of the first tasks is to review the available interfaces. In the case of this arcade cabinet, the available interfaces are relatively slim at first glance. Users interact with this device through the joystick/buttons and a USB port on the side of the cabinet. There seems to be little information regarding the USB port on the side of the cabinet. Note that even in the <a href="https://arcade1up.com/collections/counter-cade/products/marvel-super-heroes-2-player-counter-cade">pictures</a> on the site, there is no USB port. However,  there is a USB device port on the side of the cabinet meant to provide external controller support. On the opposite side, we have a standard headphone jack. These two peripherals behave as expected, the USB port can be used to attach an external controller, and the headphone jack works as advertised.</p>
<p><em>RE Tip</em>: On some older mobile phones, it was possible to configure the audio jack to present a serial terminal on boot. More information on this can be found <a href="https://masneyb.github.io/nexus-5-upstream/UART_CABLE.html">here</a>. Unfortunately, no such modifications worked on this platform.</p>
<p>With the current knowledge, there does not seem to be much more we can explore externally. So, next, we will open the cabinet up and see what is inside!</p>
<h2>Cabinet Teardown</h2>
<p>The cabinet is pretty empty, except for a metal housing attached to the screen.</p>
<p><img alt="Cabinet Internals" src="https://voidstarsec.com/blog/assets/images/cabinet-internals.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Beneath the metal enclosure, we find the main PCB for our cabinet; after gently removing an additional metal shield, we see the following.</p>
<p><img alt="Motherboard" src="https://voidstarsec.com/blog/assets/images/motherboard.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>When looking at a PCB such as this for the first time, we first want to take note of any part numbers and see if we can find any datasheets. The first component that stands out to me has been highlighted in blue.</p>
<p><img alt="Rockchip CPU" src="https://voidstarsec.com/blog/assets/images/cpu.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>This part reads <code>Rockchip RK3128</code> if we search this part number online, we find a large amount of information - see the information below that was pulled from <a href="http://rockchip.wikidot.com/rk3128">the Rockchip wiki</a></p>
<ul>
<li>CPU<ul>
<li>Quad-core ARM Cortex-A7MP Core processor, a high-performance, low-power and cached application processor</li>
<li>Full implementation of the ARM architecture v7-A instruction set, ARM Neon Advanced SIMD (single instruction, multiple data) support for accelerated media and signal processing computation</li>
</ul>
</li>
<li>GPU<ul>
<li>ARM Mali400 MP2</li>
<li>High performance OpenGL ES1.1 and 2.0, OpenVG1.1 etc</li>
</ul>
</li>
<li>Memory<ul>
<li>8KB internal SRAM</li>
<li>Dynamic Memory Interface (DDR3/DDR3L/LPDDR2)ï¼š Compatible with JEDEC standard DDR3-1066/DDR3L-1066/LPDDR2-800 SDRAM. Supports 32 Bits data width, 2 ranks (chip selects), totally 2GB (max) address space.</li>
<li>Nand Flash Interface: Support 8bits async/toggle/syncnandflash, up to 4 banks. 16bits, 24bits, 40bits, 60bits hardware ECC</li>
<li>eMMC Interface: Compatible with standard eMMC interface, Support MMC4.5 protocol</li>
</ul>
</li>
<li>Video<ul>
<li>Real-time video decoder of MPEG-1, MPEG-2, MPEG-4,H.263, H.264, H.265, VC-1, VP8, MVC</li>
</ul>
</li>
<li>Audio<ul>
<li>I2S/PCM with 8 channels: Up to 8 channels (8xTX, 2xRX). Audio resolution from 16bits to 32bits. Sample rate up to 192KHz</li>
<li>I2S/PCM with 2ch: Up to 2 channels (2xTX, 2xRX). Audio resolution from 16bits to 32bits. Sample rate up to 192KHz</li>
</ul>
</li>
<li>Connectivity<ul>
<li>SPI Controller: One on-chip SPI controller</li>
<li>UART Controller: 3 on-chip UART controllers</li>
<li>I2C controller: 4 on-chip I2C controllers</li>
<li>USB Host2.0: Embedded 1 USB Host 2.0 interfaces</li>
<li>USB OTG2.0: Compatible with USB OTG2.0 specification. Supports high-speed(480Mbps), full-speed(12Mbps) and low-speed(1.5Mbps) mode</li>
</ul>
</li>
</ul>
<p>From this description alone, we have learned much about our target processor. We now know the architecture and available peripherals and interfaces; these are useful to us as they may outline attack vectors in the future. It is important to remember that there is no such thing as too much information in this phase of the reverse engineering process. We want to learn as much about our target before attempting to interface with it.</p>
<p>Directly next to the CPU, we have another component highlighted in orange below.</p>
<p><img alt="SRAM" src="https://voidstarsec.com/blog/assets/images/sram.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>This component is marked <code>SEC931 K4B2G1646F-BYMA</code>, we are lucky and searching this part number results in <a href="https://www.samsung.com/semiconductor/dram/ddr3/K4B2G1646F-BYMA/">this webpage from Samsung</a>. The information on this page tells us that this is a 2GB DDR3 SDRAM chip. <a href="https://semiconductor.samsung.com/resources/data-sheet/DS_K4B2G1646F_BY_M_Rev1_0-1.pdf">A datasheet</a> can also be acquired from this page; it is always worth collecting datasheets when they are available when doing this kind of work. This chip is responsible for expanding the available memory to the CPU and providing a volatile memory source (RAM).</p>
<p>Thus far, we have identified what is likely the main CPU and the external RAM. However, we are still missing a type of non-volatile storage. So, next, let's examine the component highlighted in pink below.</p>
<p><img alt="EEPROM" src="https://voidstarsec.com/blog/assets/images/winbond.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>This component is labeled <code>Winbond 25N01GVZEIG</code> searching this part number leads us to <a href="https://www.winbond.com/resource-files/W25N01GV%20Rev%20Q%20051721.pdf">this datasheet</a>. This part is a 1G-bit serial SLC NAND flash memory chip. According to the datasheet, this chip utilizes the Serial Peripheral Interface and is compatible with voltage ranges between 2.6V and 3.3V. This chip likely houses the majority of the data in use by the cabinet and will be our main target for firmware extraction. </p>
<p>The last component is near the  GPIO lines and is marked <code>MIX2018A</code>. This component is unlike the others that we have seen in that I could not find nearly as much information. However, based on a few <a href="https://shophu2.ashdiabuisf.ru/content?c=mix2018a%20ic%20chip%20datasheet&amp;id=1">sites</a>, it would appear that this IC is an audio amplifier. The few mentions of this part that I was able to locate online all refer to it as such, so we will assume that is its function for the time being.</p>
<p>To recap the components that we've identified thus far, we have:</p>
<ol>
<li>Rockchip RK3128 ARM CPU</li>
<li>Samsung SRAM Chip</li>
<li>Winbond 1GBit NAND flash</li>
<li>MIX2018A Audio Amplifier</li>
</ol>
<p>Now that we have reviewed the integrated circuits on this board let's look at the connectors on the board and see what we can learn.</p>
<h2>Connector Analysis</h2>
<p>Now that we've documented the discrete components on the motherboard, we will attempt to identify the external connectors on the motherboard. First, we have the barrel connector; this connector is
outlined in blue in the image below:</p>
<p><img alt="Barrel Connector" src="https://voidstarsec.com/blog/assets/images/power.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>This connector is used to supply power to the cabinet. </p>
<p>Directly to the right of the barrel connector, we have a micro-USB port. This should immediately raise eyebrows for two reasons:</p>
<ol>
<li>This is <em>not</em> a user-facing port</li>
<li>This is not a USB host port; this is a micro port, indicative of a USB device or possibly an OTG (on the go) controller</li>
</ol>
<p><img alt="USB Device" src="https://voidstarsec.com/blog/assets/images/usb-device.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Continuing to the right, we have two rows of header pins. These were connected via the grey ribbon cable shown in the earlier images. This connector goes to a separate control board and is used to handle the joysticks/buttons.</p>
<p><img alt="Panel Connector" src="https://voidstarsec.com/blog/assets/images/panel.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>After our control panel connector, there is another four-pin connector. With this connector, it's not quite as obvious where it leads. For example, this connector could lead to the USB connector or the headphone jack. We can try to determine this with the multimeter using a <a href="https://www.youtube.com/watch?v=5G622WDZaHg">continuity test</a>. A continuity test will check if current can flow between the two probes and is usually indicated with one of the following symbols on your multimeter:</p>
<p><img alt="Continuity Two" src="https://arduinotogo.com/wp-content/uploads/2016/07/ch2-continuity-symbol-01.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>We can use this model to test if two components are connected. I inserted a 3/4 headphone cable into the headphone jack and held the probe to one of the metal rings to test this. Using the other probe, I touched each point of the four-pin connector, and on one of the lines, the multimeter let out a loud beep, letting us know a connection exists between these two points. Each of the three pins coincided with a ring on the audio connector; this is our audio jack!</p>
<p><img alt="Audio Connector" src="https://voidstarsec.com/blog/assets/images/audio.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Next, we have the connector for the display:</p>
<p><img alt="Display Connector" src="https://voidstarsec.com/blog/assets/images/display.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Near the display, we have two two-pin connectors, the one in the lower right-hand corner is used t power the backlight for the marquee, and the other goes to an on/off switch that resides on the outside of the metal housing.</p>
<p><img alt="Marquee Backlight Connector" src="https://voidstarsec.com/blog/assets/images/marquee.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p><img alt="On Off Switch" src="https://voidstarsec.com/blog/assets/images/on-switch.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>The following connector looks similar to the audio connector; it is a four-pin connector whose cables route to the control panel. There is only one other interface that we've not yet accounted for, and that is the USB connector on the side of the cabinet. If we set our multimeters to continuity mode and test the pins of this connector against the USB connector on the side of the cabinet, we find that they are indeed connected. This is our external USB connector.</p>
<p><img alt="USB Connector" src="https://voidstarsec.com/blog/assets/images/usb.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>We have identified all of the connections that we had to disconnect to better look at the board. Therefore, there are only a few things left for us to inspect. When examining a PCB, one thing to look for is any unused test pads or vias; I have highlighted the unused headers/pads in the image below.</p>
<p><img alt="Unused Headers" src="https://voidstarsec.com/blog/assets/images/headers.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>In the above image, we can see that we have three different sets of unpopulated headers or pads. On the top of the PCB, we have three vias; a via is used to make a connection between multiple layers of a PCB. When examining an embedded system, vias such as this are often a good starting point as they may represent a debug header used during development.</p>
<p><img alt="Possible UART 1" src="https://voidstarsec.com/blog/assets/images/uart1.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>The other unpopulated is made up of 16 pads and is indicated by a white rectangle and a small circle. This grouping of pads likely was meant for another integrated circuit that was not needed on this board.</p>
<p><img alt="Unused Headers" src="https://voidstarsec.com/blog/assets/images/unpopulated-ic.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Finally, the last set of pads looks very similar to the connectors used for USB and Audio. When looking at unused pads, four-pin connections like this are often candidates for a debug console via UART; we will examine these headers and discuss UART in the next section.</p>
<p><img alt="Possible UART 2" src="https://voidstarsec.com/blog/assets/images/uart2.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<hr>
<h2>Examining Debug Headers</h2>
<p>When looking at unknown headers like those pointed out in the section above, I usually start by measuring the voltage. We can do this using <a href="https://www.youtube.com/watch?v=TdUK6RPdIrA">our multimeters</a>. To calculate the voltage on these pads, we will set the multimeter to DC measurement mode and probe the locations of interest while holding our black probe on a ground point. The pins measure as follows:</p>
<table class="table table-striped table-hover">
<thead>
<tr>
<th align="center">Pin</th>
<th align="center">Voltage Level</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">0v</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">0v</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">0v</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">0v</td>
</tr>
</tbody>
</table>
<p>There is no voltage on these lines; while this is disappointing, it is not unexpected. If this were an active UART or another digital signal being transmitted, we would have expected to see some activity in the form of voltage fluctuations. Let's move on to the other three-pin header.</p>
<p><img alt="UART Connector" src="https://voidstarsec.com/blog/assets/images/uart-colors.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<table class="table table-striped table-hover">
<thead>
<tr>
<th align="center">Pin</th>
<th align="center">Voltage Level</th>
<th align="center">Color</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">2.7v</td>
<td align="center">Pink</td>
</tr>
<tr>
<td align="center">2</td>
<td align="center">1.4-3.3v</td>
<td align="center">Yellow</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">GND</td>
<td align="center">Black</td>
</tr>
</tbody>
</table>
<p>When measuring this connector, our second pin fluctuates wildly on startup and then settles at 3.3V; see the gif below for an example of what these fluctuations look like:</p>
<p><img alt="UART Startup Voltages" src="https://voidstarsec.com/blog/assets/images/serial.gif" style="display:block; margin-left:auto; margin-right:auto"></p>
<p><strong>RE Note:</strong> You might not always see voltage fluctuations of this magnitude when searching for a serial port. The fluctuations are directly correlated to how active the signal is, meaning that if there is little traffic, you will see little to no fluctuation. If you suspect that you have a UART header or some kind of digital interface, it's always a good idea to check with a logic analyzer.</p>
<p>We see what <em>might</em> look like signal activity (based on the voltage fluctuations). Next, we will examine this traffic with our logic analyzer. Logic analyzers help us convert these voltage fluctuations into a human-readable sequence of ones and zeros. To do this, we will connect our logic analyzer to our two points of interest using female-female jumper wires as shown below:</p>
<p><img alt="Logic Analyzer" src="https://voidstarsec.com/blog/assets/images/logic-analyzer.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>With the analyzer connected, we will launch Pulseview and select our analyzer from the drop-down menu; this device is displayed as a "Saleae Logic" device in pulseview. The max capture rate for this analyzer is 24MHz which we will be using for our analysis. We also need to specify the sample count, which I have set to 500G Samples. </p>
<p><img alt="Pulseview Settings" src="https://voidstarsec.com/blog/assets/images/pulseview-settings.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>We will launch a capture by clicking Run, then power up the cabinet with these settings. </p>
<p><img alt="Captured Traffic" src="https://voidstarsec.com/blog/assets/images/pulseview-uart.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Success! We have captured some traffic; before we go further in pulseview, let's talk more about how UART works at a signal level. We have confirmed that there is some kind of traffic being transmitted over these lines; next, we need to learn a little more about UART traffic and how to analyze it.</p>
<h1>UART</h1>
<p>UART stands for Universal Asynchronous Receiver Transmitter. UART is a two-wire asynchronous serial protocol that allows two devices to communicate. The two lines required for each party are the Transmit (Tx) and receive (Rx) lines. A UART can be used for many things on an embedded system, including communicating with other processors, sensor communications, and debug access. UART is an asynchronous protocol meaning that there is no clock signal required. Instead, both communicating parties are preconfigured to communicate at a certain speed, referred to as the baud rate. The baud rate is measured in bits per second.</p>
<p>A UART packet/transmission consists of the following fields:</p>
<table class="table table-striped table-hover">
<thead>
<tr>
<th align="center">Bit Position</th>
<th align="center">Name</th>
<th align="center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">0:1</td>
<td align="center">Start bit</td>
<td align="center">Used to signify the start of a packet</td>
</tr>
<tr>
<td align="center">1:9</td>
<td align="center">Data bits (this can also be configured to be any value really, but is commonly 8)</td>
<td align="center">The data to be sent/read, note that data is typically sent with the least significant bit first</td>
</tr>
<tr>
<td align="center">9:10</td>
<td align="center">Parity bit</td>
<td align="center">one if the data bits contain an off number of ones, 0 otherwise</td>
</tr>
<tr>
<td align="center">10:12</td>
<td align="center">Stop bits</td>
<td align="center">This signifies that the packet has ended</td>
</tr>
</tbody>
</table>
<p>Even with the packet definitions above, it is difficult for us to determine the contents of our logic capture. Luckily for us, Pulseview has a UART decoder that we can take advantage of.</p>
<h2>Decoding UART Traffic</h2>
<p>Using pulseview, we can attempt to decode this traffic and see if it indeed is an active UART. To set up a decoder, click the green and yellow symbols below. This will open the decoder selection window, type uart in the search bar, and select the UART decoder.</p>
<p><img alt="Decoder Button" src="https://voidstarsec.com/blog/assets/images/decoder-button.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p><img alt="Decoder Selection" src="https://voidstarsec.com/blog/assets/images/decoder-selector.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Next, we need to configure the UART decoder. We need to select the appropriate channels and set any protocol-specific parameters this decoder needs. See the configurable parameters below:</p>
<p><img alt="Decoder Configuration" src="https://voidstarsec.com/blog/assets/images/decoder-configuration.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>First, we select our Rx line as our channel containing traffic; in our case, that will be <code>D1</code>. For all of the other fields, we will leave them at their default values, 8-bit data width, no parity, etc. </p>
<p>There is one thing that we need to investigate and fill in ourselves: the baud rate. Remember that the two parties must agree on the baud rate ahead of time; there is no negotiation/startup sequence. We will need to determine this baud rate ourselves; otherwise, the decoder will not know how to parse these signals correctly. To determine the baud rate, we can do the following.</p>
<ol>
<li>Zoom in on what appears to be one of the smallest pulses (presumably, this represents one bit being sent over the wire)</li>
<li>Select the pulse width using the data markers in Pulseview, click the button shown below to enable them:</li>
</ol>
<p><img alt="Pulseview Marker" src="https://voidstarsec.com/blog/assets/images/pulseview-marker.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<ol>
<li>With the small pulse range selected, Pulseview will automatically calculate the frequency and give us a measurement in hertz, as shown in the screenshot below.</li>
</ol>
<p><img alt="Pulseview Measurement" src="https://voidstarsec.com/blog/assets/images/pulseview-measurement.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Hertz is measured in cycles per second; recall that our baud rate is a measurement of bits per second. So, therefore, if we have highlighted one bit being sent over the wire and the frequency of that pulse, we also have the baud rate.</p>
<p>Our calculated frequency according to Pulseview is 115.384 kHz, which translates to a baud rate of 115385 bits/s. Those familiar with debug consoles might notice that this is very close to a <a href="https://lucidar.me/en/serialib/most-used-baud-rates-table/">commonly used baud rate</a> of 115200. So let's plug that value into our decoder and see what happens.</p>
<p>If we look at the screenshot below, we can see that we have what appears to be a valid debug log.</p>
<p><img alt="Decoded UART Traffic" src="https://voidstarsec.com/blog/assets/images/decoded2.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>We have an active UART and know its baud rate, but now we need to find a way to interface with it. To do this, we will use the Raspberry Pi. The updated cabinet the pinout is as follows:</p>
<p><img alt="Updated Pinout" src="https://voidstarsec.com/blog/assets/images/uart-colors-annotated.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<h2>Configuring the Raspberry Pi</h2>
<p>The Raspberry Pi has multiple UARTS available; the UART that we will use has been highlighted in the image below:</p>
<p><img alt="Pi UART" src="https://voidstarsec.com/blog/assets/images/pi-gpio-uart.svg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>We will need to ensure that the appropriate device tree blob is enabled to enable this UART. The purpose of a device tree blob is to provide a way for the kernel to understand the available hardware peripherals. The kernel will read this binary information at startup and enumerate the specified peripherals. When reverse engineering an embedded Linux system, extracting this information can be beneficial because it can be decompiled and outline where various peripherals are in memory. </p>
<p>All relevant device tree blobs on the raspberry pi can be located in <code>/boot/overlays/</code>. In this folder, you will find device tree binary objects for multiple hardware configurations, some for specific hats (custom PCBs designed for the Pi) that can be attached to the Pi and others for enabling the assorted IO peripherals. We can enable the appropriate DTB for the UART peripheral using the <code>raspi-config</code> tool.</p>
<h2>Using Raspi Config</h2>
<p><code>raspi-config</code> is a user-space tool that allows us to configure various aspects of the Raspberry Pi, one of which is enabling the various external interfaces. We're going to use <code>raspi-config</code> to enable the UART interface; start by launching the tool as follows:</p>
<p><code>sudo raspi-config</code>
This will cause the following screen to appear:</p>
<p><img alt="Pi UART" src="https://voidstarsec.com/blog/assets/images/raspi-config.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Next, we will select <code>Interface Options</code>, and then <code>Serial Port</code> as shown in the image below:</p>
<p><img alt="Pi UART Configuration" src="https://voidstarsec.com/blog/assets/images/raspi-config.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>After selecting this option, we will be presented with two questions:</p>
<ol>
<li>Would you like a login shell to be accessible over serial?</li>
<li>No</li>
<li>Would you like the serial port hardware to be enabled?</li>
<li>Yes</li>
</ol>
<p>We have now enabled the UART on the Raspberry Pi. Next, we need to connect it to our cabinet. We will connect Tx of the cabinet to Rx of the Pi, and Rx of the cabinet to Tx of the Pi:</p>
<p><img alt="Pi UART Configuration" src="https://voidstarsec.com/blog/assets/images/pi-cab_bb.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<h2>UART Tools</h2>
<p>Using the UART interface on the Raspberry Pi, we can attempt to connect to this serial port on the target. In order to interact with this serial port, we will use the <code>screen</code> utility. Screen requires that we pass it a device and baud rate when interfacing with a UART; since we know the baud rate from our previous segment, we will run screen as follows:</p>
<p><code>sudo screen -L -Logfile cabinet-bootup.log /dev/ttyS0 115200</code></p>
<ul>
<li><code>-L -Logfile cabinet-bootup.log</code> - Record the session to the ``cabinet-bootup.log``` file</li>
<li><code>/dev/ttyS0</code> - Serial device to use</li>
<li><code>115200</code> - Baud rate</li>
</ul>
<p>We can now power on the cabinet after configuring our UART and launching screen. When we power on the cabinet, we see the following:</p>
<p><img alt="Terminal Screenshot" src="https://voidstarsec.com/blog/assets/images/pi-terminal.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>And eventually, we find ourselves at a console:</p>
<p><img alt="Terminal Screenshot" src="https://voidstarsec.com/blog/assets/images/shell.png" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>We have a root console now; we can explore the filesystem, see what is running on the target and learn more about how it was constructed. Our next step will be to image the partitions if possible; let's start by looking at what partitions are mounted:</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span><span class="n">root</span><span class="err">@</span><span class="n">rk3128</span><span class="p">:</span><span class="o">/</span><span class="p">]</span><span class="c1"># mount</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">root</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">squashfs</span><span class="w"> </span><span class="p">(</span><span class="n">ro</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="n">devtmpfs</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">devtmpfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">103544</span><span class="n">k</span><span class="p">,</span><span class="n">nr_inodes</span><span class="o">=</span><span class="mi">25886</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="mi">755</span><span class="p">)</span>
<span class="n">proc</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">proc</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">proc</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="n">devpts</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">pts</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">devpts</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">gid</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="mi">620</span><span class="p">,</span><span class="n">ptmxmode</span><span class="o">=</span><span class="mi">000</span><span class="p">)</span>
<span class="n">tmpfs</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">shm</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">112248</span><span class="n">k</span><span class="p">,</span><span class="n">nr_inodes</span><span class="o">=</span><span class="mi">28062</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="mi">777</span><span class="p">)</span>
<span class="n">tmpfs</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">112248</span><span class="n">k</span><span class="p">,</span><span class="n">nr_inodes</span><span class="o">=</span><span class="mi">28062</span><span class="p">)</span>
<span class="n">tmpfs</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">112248</span><span class="n">k</span><span class="p">,</span><span class="n">nr_inodes</span><span class="o">=</span><span class="mi">28062</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="mi">755</span><span class="p">)</span>
<span class="n">sysfs</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">sysfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="n">debug</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">debug</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">debugfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="n">pstore</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">fs</span><span class="o">/</span><span class="n">pstore</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">pstore</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">root</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">squashfs</span><span class="w"> </span><span class="p">(</span><span class="n">ro</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="n">tmpfs</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">tmpfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">nosuid</span><span class="p">,</span><span class="n">nodev</span><span class="p">,</span><span class="n">relatime</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">112248</span><span class="n">k</span><span class="p">,</span><span class="n">nr_inodes</span><span class="o">=</span><span class="mi">28062</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="mi">755</span><span class="p">)</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">rkflash0p5</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">userdata</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">ext2</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="n">none</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">sys</span><span class="o">/</span><span class="n">kernel</span><span class="o">/</span><span class="n">config</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">configfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
<span class="n">adb</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">usb</span><span class="o">-</span><span class="n">ffs</span><span class="o">/</span><span class="n">adb</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">functionfs</span><span class="w"> </span><span class="p">(</span><span class="n">rw</span><span class="p">,</span><span class="n">relatime</span><span class="p">)</span>
</code></pre></div>

<p>Our root filesystem is mounted as read-only and is using the squashfs format. In addition, another partition is mounted that is labeled <code>userdata</code>. If we examine the available block devices, we see the following:</p>
<div class="highlight"><pre><span></span><code><span class="o">[</span><span class="n">root@rk3128:/</span><span class="o">]</span><span class="err">#</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">-</span><span class="n">lathr</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">block</span><span class="o">/</span><span class="k">by</span><span class="o">-</span><span class="n">name</span><span class="o">/</span>
<span class="n">lrwxrwxrwx</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w">     </span><span class="n">root</span><span class="w">          </span><span class="mi">16</span><span class="w"> </span><span class="n">Jan</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">userdata</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">rkflash0p5</span>
<span class="n">lrwxrwxrwx</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w">     </span><span class="n">root</span><span class="w">          </span><span class="mi">16</span><span class="w"> </span><span class="n">Jan</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">uboot</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">rkflash0p1</span>
<span class="n">lrwxrwxrwx</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w">     </span><span class="n">root</span><span class="w">          </span><span class="mi">16</span><span class="w"> </span><span class="n">Jan</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">trust</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">rkflash0p2</span>
<span class="n">lrwxrwxrwx</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w">     </span><span class="n">root</span><span class="w">          </span><span class="mi">16</span><span class="w"> </span><span class="n">Jan</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">rootfs</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">rkflash0p4</span>
<span class="n">lrwxrwxrwx</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="n">root</span><span class="w">     </span><span class="n">root</span><span class="w">          </span><span class="mi">16</span><span class="w"> </span><span class="n">Jan</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="p">..</span><span class="o">/</span><span class="n">rkflash0p3</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w">    </span><span class="mi">3</span><span class="w"> </span><span class="n">root</span><span class="w">     </span><span class="n">root</span><span class="w">         </span><span class="mi">380</span><span class="w"> </span><span class="n">Jan</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="p">..</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span><span class="w">    </span><span class="mi">2</span><span class="w"> </span><span class="n">root</span><span class="w">     </span><span class="n">root</span><span class="w">         </span><span class="mi">140</span><span class="w"> </span><span class="n">Jan</span><span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mi">00</span><span class="err">:</span><span class="mi">00</span><span class="w"> </span><span class="p">.</span>
</code></pre></div>

<p>We can see that we presumably have our SPI flash device at <code>/dev/rkflash0</code>. To get an image of this block device, we can plug a USB stick into the cabinet's USB port and use the <code>dd</code> utility. When we insert a USB flash drive, it is enumerated at <code>/dev/sda</code> we can image the USB drive with the contents of the SPI flash using the following command:</p>
<p><code>sudo dd if=/dev/rkflash0 of=/dev/sda status=progress</code></p>
<p>If we plug the USB drive into the Pi and examine the partition table we see that the appropriate partitions have been imaged to the drive!</p>
<div class="highlight"><pre><span></span><code><span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">lsblk</span>
<span class="n">NAME</span><span class="w">        </span><span class="nl">MAJ</span><span class="p">:</span><span class="nf">MIN</span><span class="w"> </span><span class="n">RM</span><span class="w">  </span><span class="k">SIZE</span><span class="w"> </span><span class="n">RO</span><span class="w"> </span><span class="n">TYPE</span><span class="w"> </span><span class="n">MOUNTPOINT</span>
<span class="n">sda</span><span class="w">           </span><span class="mi">8</span><span class="err">:</span><span class="mi">0</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="mf">57.8</span><span class="n">G</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="k">disk</span>
<span class="err">â”œâ”€</span><span class="n">sda1</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">1</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">4</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda2</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">2</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda3</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">3</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">9</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda4</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">4</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="mf">80.8</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â””â”€</span><span class="n">sda5</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">5</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">8</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
</code></pre></div>

<p>Now we have a backup of the flash, which is the first step that we should take when attempting to modify an embedded system; before we try to modify anything or reflash any partitions, we should make sure that we have a way to recover them; to do this, we will investigate the bootloader. As a starting point, lets take note of the following line at the beginning of the bootup log:</p>
<div class="highlight"><pre><span></span><code>CLK: (uboot. arm: enter 600000 KHz, init 600000 KHz, kernel 0N/A)
  apll 600000 KHz
  dpll 600000 KHz
  cpll 650000 KHz
  gpll 594000 KHz
  armclk 600000 KHz
  aclk_cpu 148500 KHz
  hclk_cpu 74250 KHz
  pclk_cpu 74250 KHz
  aclk_peri 148500 KHz
  hclk_peri 74250 KHz
  pclk_peri 74250 KHz
Net:   Net Initialization Skipped
No ethernet found.
Hit key to stop autoboot(&#39;CTRL+C&#39;):  0
</code></pre></div>

<p>If we hold down <code>Ctrl-c</code> in our screen prompt while powering the cabinet, we see the following:</p>
<div class="highlight"><pre><span></span><code>Hit key to stop autoboot(&#39;CTRL+C&#39;):  0
=&gt; &lt;INTERRUPT&gt;
</code></pre></div>

<p>We now have a UBoot prompt; before we dive into this further, let's talk about UBoot and how it works.</p>
<hr>
<h1>UBoot</h1>
<p><a href="https://www.denx.de/wiki/U-Boot">UBoot</a> is an open-source bootloader commonly used in embedded systems. It has support for a wide variety of architectures and CPU types. However, the responsibility of UBoot is usually to load the operating system kernel or the main application for the embedded system. </p>
<p>UBoot also includes debug utilities useful during your reverse engineering efforts; most notable is the UBoot command prompt. </p>
<h2>UBoot Commands</h2>
<p>The UBoot console can contain a large number of built-in utilities. These utilities can be used during the standard boot process (often through environment variables) or at the UBoot command line. The available commands will vary depending on how the UBoot image was built. </p>
<p>Now that we have discovered a UBoot console let's start by seeing which commands are publically available to us by running the <code>help command</code></p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="n">android_print_hdr</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">bdinfo</span><span class="w"> </span><span class="n">bidram_dump</span><span class="w"> </span><span class="n">BMP</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">boot_android</span><span class="w"> </span><span class="n">bootavb</span>
<span class="w">  </span><span class="n">bootd</span><span class="w"> </span><span class="n">bootm</span><span class="w"> </span><span class="n">bootp</span><span class="w"> </span><span class="n">bootrkp</span><span class="w"> </span><span class="n">bootz</span><span class="w"> </span><span class="n">charge</span><span class="w"> </span><span class="n">cmp</span><span class="w"> </span><span class="n">coninfo</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="n">crc32</span><span class="w"> </span><span class="o">...</span>
<span class="o">=&gt;</span><span class="w"> </span>
<span class="err">?</span><span class="w">       </span><span class="o">-</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="s1">&#39;help&#39;</span>
<span class="n">android_print_hdr</span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">android</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">header</span>
<span class="n">base</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="n">offset</span>
<span class="n">bdinfo</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">Board</span><span class="w"> </span><span class="n">Infostructure</span>
<span class="n">bidram_dump</span><span class="o">-</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">bidram</span><span class="w"> </span><span class="n">layout</span>
<span class="n">BMP</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">manipulate</span><span class="w"> </span><span class="n">BMP</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">data</span>
<span class="n">boot</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">default</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="s1">&#39;bootcmd&#39;</span>
<span class="n">boot_android</span><span class="o">-</span><span class="w"> </span><span class="n">Execute</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Android</span><span class="w"> </span><span class="n">Bootloader</span><span class="w"> </span><span class="n">flow</span><span class="o">.</span>
<span class="n">bootavb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Execute</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Android</span><span class="w"> </span><span class="n">avb</span><span class="w"> </span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">flow</span><span class="o">.</span>
<span class="n">bootd</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">default</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">.</span><span class="n">e</span><span class="o">.</span><span class="p">,</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="s1">&#39;bootcmd&#39;</span>
<span class="n">bootm</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">memory</span>
<span class="n">bootp</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">BOOTP</span><span class="o">/</span><span class="n">TFTP</span><span class="w"> </span><span class="n">protocol</span>
<span class="n">bootrkp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">Image</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">rockchip</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">type</span>
<span class="n">Bootz</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">zImage</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">memory</span>
<span class="n">charge</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Charge</span><span class="w"> </span><span class="n">display</span>
<span class="n">CMP</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">compare</span>
<span class="n">coninfo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">console</span><span class="w"> </span><span class="n">devices</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">information</span>
<span class="n">cp</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">copy</span>
<span class="n">crc32</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">checksum</span><span class="w"> </span><span class="n">calculation</span>
<span class="n">DHCP</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">DHCP</span><span class="o">/</span><span class="n">TFTP</span><span class="w"> </span><span class="n">protocol</span>
<span class="n">dm</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">Driver</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="n">low</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="n">access</span>
<span class="n">download</span><span class="o">-</span><span class="w"> </span><span class="n">enter</span><span class="w"> </span><span class="n">rockusb</span><span class="o">/</span><span class="n">bootrom</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">mode</span>
<span class="n">dtimg</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">manipulate</span><span class="w"> </span><span class="n">dtb</span><span class="o">/</span><span class="n">dtbo</span><span class="w"> </span><span class="n">Android</span><span class="w"> </span><span class="n">image</span>
<span class="n">dump_atags</span><span class="o">-</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">atags</span>
<span class="n">dump_irqs</span><span class="o">-</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">IRQs</span>
<span class="n">echo</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">args</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">console</span>
<span class="n">editenv</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">edit</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span>
<span class="n">env</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">handling</span><span class="w"> </span><span class="n">commands</span>
<span class="n">exit</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">exit</span><span class="w"> </span><span class="n">script</span>
<span class="n">ext2load</span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Ext2</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">ext2ls</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">/</span><span class="p">)</span>
<span class="n">ext4load</span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Ext4</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">ext4ls</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">/</span><span class="p">)</span>
<span class="n">ext4size</span><span class="o">-</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="s1">&#39;s size</span>
<span class="bp">false</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">nothing</span><span class="p">,</span><span class="w"> </span><span class="n">unsuccessfully</span>
<span class="n">fastboot</span><span class="o">-</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">UDP</span><span class="w"> </span><span class="n">Fastboot</span><span class="w"> </span><span class="n">protocol</span>
<span class="n">fatinfo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">fatload</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dos</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">fatls</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">/</span><span class="p">)</span>
<span class="n">fantasize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="s1">&#39;s size</span>
<span class="n">fatwrite</span><span class="o">-</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dos</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">fdt</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">flattened</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="n">utility</span><span class="w"> </span><span class="n">commands</span>
<span class="n">fstype</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Lookup</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="n">type</span>
<span class="n">go</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="n">application</span><span class="w"> </span><span class="n">at</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="s1">&#39;addr&#39;</span>
<span class="n">gpt</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">GUID</span><span class="w"> </span><span class="n">Partition</span><span class="w"> </span><span class="n">Table</span>
<span class="n">help</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">description</span><span class="o">/</span><span class="n">usage</span>
<span class="n">iomem</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Show</span><span class="w"> </span><span class="n">iomem</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">compatible</span><span class="p">(</span><span class="n">high</span><span class="w"> </span><span class="n">priority</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">node</span><span class="w"> </span><span class="n">name</span>
<span class="n">lcdputs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">string</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">video</span><span class="w"> </span><span class="n">framebuffer</span>
<span class="nb">load</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">loop</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">infinite</span><span class="w"> </span><span class="n">loop</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="nb">range</span>
<span class="n">ls</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">/</span><span class="p">)</span>
<span class="n">MD</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">display</span>
<span class="n">mii</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">MII</span><span class="w"> </span><span class="n">utility</span><span class="w"> </span><span class="n">commands</span>
<span class="n">mm</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="p">(</span><span class="n">auto</span><span class="o">-</span><span class="n">incrementing</span><span class="w"> </span><span class="n">address</span><span class="p">)</span>
<span class="n">mmc</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">MMC</span><span class="w"> </span><span class="n">subsystem</span>
<span class="n">mmcinfo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">MMC</span><span class="w"> </span><span class="n">info</span>
<span class="n">MW</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="p">(</span><span class="n">fill</span><span class="p">)</span>
<span class="n">NFS</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">NFS</span><span class="w"> </span><span class="n">protocol</span>
<span class="n">nm</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="p">(</span><span class="n">constant</span><span class="w"> </span><span class="n">address</span><span class="p">)</span>
<span class="n">part</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">disk</span><span class="w"> </span><span class="n">partition</span><span class="w"> </span><span class="n">related</span><span class="w"> </span><span class="n">commands</span>
<span class="n">ping</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">Send</span><span class="w"> </span><span class="n">ICMP</span><span class="w"> </span><span class="n">ECHO_REQUEST</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">host</span>
<span class="n">printenv</span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variables</span>
<span class="n">pxe</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">pxe</span><span class="w"> </span><span class="n">files</span>
<span class="n">rbrom</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Perform</span><span class="w"> </span><span class="n">RESET</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CPU</span>
<span class="n">reboot</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Perform</span><span class="w"> </span><span class="n">RESET</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CPU</span><span class="p">,</span><span class="w"> </span><span class="n">alias</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="s1">&#39;reset&#39;</span>
<span class="n">reset</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Perform</span><span class="w"> </span><span class="n">RESET</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">CPU</span>
<span class="n">rkimgtest</span><span class="o">-</span><span class="w"> </span><span class="n">Test</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">media</span><span class="w"> </span><span class="n">have</span><span class="w"> </span><span class="n">rockchip</span><span class="w"> </span><span class="n">image</span>
<span class="n">rknand</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">rockchip</span><span class="w"> </span><span class="n">nand</span><span class="w"> </span><span class="n">flash</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="n">system</span>
<span class="n">rksfc</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">rockchip</span><span class="w"> </span><span class="n">SFC</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="n">system</span>
<span class="n">rktest</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">Rockchip</span><span class="w"> </span><span class="n">board</span><span class="w"> </span><span class="n">modules</span><span class="w"> </span><span class="n">test</span>
<span class="n">rockchip_show_bmp</span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">BMP</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">partition</span>
<span class="n">rockchip_show_logo</span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="n">partition</span>
<span class="n">rocks</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">rockusb</span><span class="w"> </span><span class="n">Protocol</span>
<span class="n">run</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">an</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variable</span>
<span class="n">save</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">save</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">setcurs</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">cursor</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="n">within</span><span class="w"> </span><span class="n">screen</span>
<span class="n">setenv</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">set</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">variables</span>
<span class="n">showvar</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">local</span><span class="w"> </span><span class="n">hushshell</span><span class="w"> </span><span class="n">variables</span>
<span class="n">size</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="s1">&#39;s size</span>
<span class="n">source</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">memory</span>
<span class="n">sysboot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">syslinux</span><span class="w"> </span><span class="n">files</span>
<span class="n">sysmem_dump</span><span class="o">-</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">layout</span>
<span class="n">sysmem_search</span><span class="o">-</span><span class="w"> </span><span class="n">Search</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">system</span><span class="w"> </span><span class="n">region</span>
<span class="n">test</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">minimal</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">sh</span>
<span class="n">TFTP</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">image</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="n">network</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">TFTP</span><span class="w"> </span><span class="n">protocol</span>
<span class="bp">true</span><span class="w">    </span><span class="o">-</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">nothing</span><span class="p">,</span><span class="w"> </span><span class="n">successfully</span>
<span class="n">ums</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">UMS</span><span class="w"> </span><span class="p">[</span><span class="n">USB</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">Storage</span><span class="p">]</span>
<span class="n">USB</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="n">system</span>
<span class="n">usbboot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">boot</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">device</span>
<span class="n">version</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">monitor</span><span class="p">,</span><span class="w"> </span><span class="n">compiler</span><span class="p">,</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">linker</span><span class="w"> </span><span class="n">version</span>
<span class="o">=&gt;</span><span class="w"> </span>
</code></pre></div>

<p>Before we spend too much time reviewing every command, let's revisit our main objective, which is to be able to read and write the root filesystem partition from the bootloader in case we need to recover this cabinet later. The following commands immediately stand out as they involve memory reading and writing:</p>
<div class="highlight"><pre><span></span><code><span class="n">download</span><span class="o">-</span><span class="w"> </span><span class="n">enter</span><span class="w"> </span><span class="n">rockusb</span><span class="o">/</span><span class="n">bootrom</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">mode</span>
<span class="n">dtimg</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">manipulate</span><span class="w"> </span><span class="n">dtb</span><span class="o">/</span><span class="n">dtbo</span><span class="w"> </span><span class="n">Android</span><span class="w"> </span><span class="n">image</span>
<span class="n">dump_atags</span><span class="o">-</span><span class="w"> </span><span class="n">Dump</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">content</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">atags</span>
<span class="n">ext2load</span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Ext2</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">ext2ls</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">/</span><span class="p">)</span>
<span class="n">ext4load</span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">Ext4</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">ext4ls</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">/</span><span class="p">)</span>
<span class="n">ext4size</span><span class="o">-</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="s1">&#39;s size</span>
<span class="n">fastboot</span><span class="o">-</span><span class="w"> </span><span class="n">use</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">UDP</span><span class="w"> </span><span class="n">Fastboot</span><span class="w"> </span><span class="n">protocol</span>
<span class="n">fatinfo</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">print</span><span class="w"> </span><span class="n">information</span><span class="w"> </span><span class="n">about</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">fatload</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">load</span><span class="w"> </span><span class="n">binary</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dos</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">fatls</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">files</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">directory</span><span class="w"> </span><span class="p">(</span><span class="n">default</span><span class="w"> </span><span class="o">/</span><span class="p">)</span>
<span class="n">fantasize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">file</span><span class="s1">&#39;s size</span>
<span class="n">fatwrite</span><span class="o">-</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dos</span><span class="w"> </span><span class="n">filesystem</span>
<span class="n">mm</span><span class="w">      </span><span class="o">-</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">modify</span><span class="w"> </span><span class="p">(</span><span class="n">auto</span><span class="o">-</span><span class="n">incrementing</span><span class="w"> </span><span class="n">address</span><span class="p">)</span>
<span class="n">rknand</span><span class="w">  </span><span class="o">-</span><span class="w"> </span><span class="n">rockchip</span><span class="w"> </span><span class="n">nand</span><span class="w"> </span><span class="n">flash</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="n">system</span>
<span class="n">rksfc</span><span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">rockchip</span><span class="w"> </span><span class="n">SFC</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="n">system</span>
<span class="n">ums</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Use</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">UMS</span><span class="w"> </span><span class="p">[</span><span class="n">USB</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">Storage</span><span class="p">]</span>
<span class="n">USB</span><span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="n">system</span>
</code></pre></div>

<p>Next, we can review the environment variables that this bootloader has configured using the <code>printenv</code> command. This will give us more context surrounding <strong>how</strong> this platform boots, what memory addresses are in use and what other interfaces may be available.</p>
<h2>UBoot Environment Variables</h2>
<p>Various environment variables can be configured when building or configuring a UBoot image for a device. These environment variables control what operations are performed on startup. There are multiple ways that these variables can be stored. Sometimes they are hardcoded into the binary itself; they can also reside on a flash partition, allowing users to modify them from the UBoot prompt.</p>
<p>We can examine the environment variables with the <code>printenv</code> command:</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span><span class="w"> </span><span class="n">printenv</span>
<span class="n">arch</span><span class="o">=</span><span class="n">arm</span>
<span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span>
<span class="n">board</span><span class="o">=</span><span class="n">evb_rk3128</span>
<span class="n">board_name</span><span class="o">=</span><span class="n">evb_rk3128</span>
<span class="n">boot_a_script</span><span class="o">=</span><span class="nb">load</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">}:</span><span class="o">$</span><span class="p">{</span><span class="n">distro_bootpart</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">scriptaddr</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">prefix</span><span class="p">}</span><span class="o">$</span><span class="p">{</span><span class="n">script</span><span class="p">};</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">scriptaddr</span><span class="p">}</span>
<span class="n">boot_extlinux</span><span class="o">=</span><span class="n">sysboot</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">}:</span><span class="o">$</span><span class="p">{</span><span class="n">distro_bootpart</span><span class="p">}</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">scriptaddr</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">prefix</span><span class="p">}</span><span class="n">extlinux</span><span class="o">/</span><span class="n">extlinux</span><span class="o">.</span><span class="n">conf</span>
<span class="n">boot_net_usb_start</span><span class="o">=</span><span class="n">usb</span><span class="w"> </span><span class="n">start</span>
<span class="n">boot_prefixes</span><span class="o">=/</span><span class="w"> </span><span class="o">/</span><span class="n">boot</span><span class="o">/</span>
<span class="n">boot_script_dhcp</span><span class="o">=</span><span class="n">boot</span><span class="o">.</span><span class="n">scr</span><span class="o">.</span><span class="n">uimg</span>
<span class="n">boot_scripts</span><span class="o">=</span><span class="n">boot</span><span class="o">.</span><span class="n">scr</span><span class="o">.</span><span class="n">uimg</span><span class="w"> </span><span class="n">boot</span><span class="o">.</span><span class="n">scr</span>
<span class="n">boot_targets</span><span class="o">=</span><span class="n">mmc1</span><span class="w"> </span><span class="n">mmc0</span><span class="w"> </span><span class="n">rknand0</span><span class="w"> </span><span class="n">usb0</span><span class="w"> </span><span class="n">pxe</span><span class="w"> </span><span class="n">dhcp</span><span class="w"> </span>
<span class="n">bootargs</span><span class="o">=</span><span class="n">storagemedia</span><span class="o">=</span><span class="n">nand</span><span class="w"> </span><span class="n">androidboot</span><span class="o">.</span><span class="n">storagemedia</span><span class="o">=</span><span class="n">nand</span><span class="w"> </span><span class="n">androidboot</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">normal</span><span class="w"> </span>
<span class="n">bootcmd</span><span class="o">=</span><span class="n">boot_android</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">};</span><span class="n">bootrkp</span><span class="p">;</span><span class="n">run</span><span class="w"> </span><span class="n">distro_bootcmd</span><span class="p">;</span>
<span class="n">bootcmd_dhcp</span><span class="o">=</span><span class="n">run</span><span class="w"> </span><span class="n">boot_net_usb_start</span><span class="p">;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">dhcp</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">scriptaddr</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">boot_script_dhcp</span><span class="p">};</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">scriptaddr</span><span class="p">};</span><span class="w"> </span><span class="n">fi</span><span class="p">;</span>
<span class="n">bootcmd_mmc0</span><span class="o">=</span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mmc_boot</span>
<span class="n">bootcmd_mmc1</span><span class="o">=</span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">mmc_boot</span>
<span class="n">bootcmd_pxe</span><span class="o">=</span><span class="n">run</span><span class="w"> </span><span class="n">boot_net_usb_start</span><span class="p">;</span><span class="w"> </span><span class="n">dhcp</span><span class="p">;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">pxe</span><span class="w"> </span><span class="n">get</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">pxe</span><span class="w"> </span><span class="n">boot</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span>
<span class="n">bootcmd_rknand0</span><span class="o">=</span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">rknand_boot</span>
<span class="n">bootcmd_usb0</span><span class="o">=</span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">usb_boot</span>
<span class="n">bootdelay</span><span class="o">=</span><span class="mi">0</span>
<span class="n">cpu</span><span class="o">=</span><span class="n">armv7</span>
<span class="n">devnum</span><span class="o">=</span><span class="mi">0</span>
<span class="n">devtype</span><span class="o">=</span><span class="n">spinand</span>
<span class="n">distro_bootcmd</span><span class="o">=</span><span class="k">for</span><span class="w"> </span><span class="n">target</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">boot_targets</span><span class="p">};</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">bootcmd_</span><span class="o">$</span><span class="p">{</span><span class="n">target</span><span class="p">};</span><span class="w"> </span><span class="n">done</span>
<span class="n">ethaddr</span><span class="o">=</span><span class="n">d2</span><span class="p">:</span><span class="mi">79</span><span class="p">:</span><span class="mi">07</span><span class="p">:</span><span class="n">fc</span><span class="p">:</span><span class="n">f7</span><span class="p">:</span><span class="mi">89</span>
<span class="n">fdt_addr1_r</span><span class="o">=</span><span class="mh">0x61700000</span>
<span class="n">fdt_addr_r</span><span class="o">=</span><span class="mh">0x68300000</span>
<span class="n">kernel_addr1_r</span><span class="o">=</span><span class="mh">0x62008000</span>
<span class="n">kernel_addr_r</span><span class="o">=</span><span class="mh">0x62008000</span>
<span class="n">mmc_boot</span><span class="o">=</span><span class="k">if</span><span class="w"> </span><span class="n">mmc</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">};</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">mmc</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">scan_dev_for_boot_part</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span>
<span class="n">pxefile_addr1_r</span><span class="o">=</span><span class="mh">0x60600000</span>
<span class="n">pxefile_addr_r</span><span class="o">=</span><span class="mh">0x60600000</span>
<span class="n">ramdisk_addr1_r</span><span class="o">=</span><span class="mh">0x63000000</span>
<span class="n">ramdisk_addr_r</span><span class="o">=</span><span class="mh">0x6a200000</span>
<span class="n">rkimg_bootdev</span><span class="o">=</span><span class="k">if</span><span class="w"> </span><span class="n">mmc</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">rkimgtest</span><span class="w"> </span><span class="n">mmc</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">mmc</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">Boot</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">SDcard</span><span class="p">;</span><span class="k">elif</span><span class="w"> </span><span class="n">mmc</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">mmc</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="k">elif</span><span class="w"> </span><span class="n">mtd_blk</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">mtd</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="k">elif</span><span class="w"> </span><span class="n">mtd_blk</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">mtd</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="k">elif</span><span class="w"> </span><span class="n">mtd_blk</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">mtd</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="k">elif</span><span class="w"> </span><span class="n">rknand</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">rknand</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="k">elif</span><span class="w"> </span><span class="n">rksfc</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">spinand</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="k">elif</span><span class="w"> </span><span class="n">rksfc</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">spinor</span><span class="p">;</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devnum</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="n">fi</span><span class="p">;</span><span class="w"> </span>
<span class="n">scan_dev_for_boot</span><span class="o">=</span><span class="n">echo</span><span class="w"> </span><span class="n">Scanning</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">}:</span><span class="o">$</span><span class="p">{</span><span class="n">distro_bootpart</span><span class="p">}</span><span class="o">...</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">prefix</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">boot_prefixes</span><span class="p">};</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">scan_dev_for_extlinux</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">scan_dev_for_scripts</span><span class="p">;</span><span class="w"> </span><span class="n">done</span><span class="p">;</span>
<span class="n">scan_dev_for_boot_part</span><span class="o">=</span><span class="n">part</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">}</span><span class="w"> </span><span class="o">-</span><span class="n">bootable</span><span class="w"> </span><span class="n">devplist</span><span class="p">;</span><span class="w"> </span><span class="n">env</span><span class="w"> </span><span class="n">exists</span><span class="w"> </span><span class="n">devplist</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devplist</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">distro_bootpart</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devplist</span><span class="p">};</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">fstype</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">}:</span><span class="o">$</span><span class="p">{</span><span class="n">distro_bootpart</span><span class="p">}</span><span class="w"> </span><span class="n">bootfstype</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">scan_dev_for_boot</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span><span class="p">;</span><span class="w"> </span><span class="n">done</span>
<span class="n">scan_dev_for_extlinux</span><span class="o">=</span><span class="k">if</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">}:</span><span class="o">$</span><span class="p">{</span><span class="n">distro_bootpart</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">prefix</span><span class="p">}</span><span class="n">extlinux</span><span class="o">/</span><span class="n">extlinux</span><span class="o">.</span><span class="n">conf</span><span class="p">;</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">Found</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">prefix</span><span class="p">}</span><span class="n">extlinux</span><span class="o">/</span><span class="n">extlinux</span><span class="o">.</span><span class="n">conf</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">boot_extlinux</span><span class="p">;</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">SCRIPT</span><span class="w"> </span><span class="n">FAILED</span><span class="p">:</span><span class="w"> </span><span class="n">continuing</span><span class="o">...</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span>
<span class="n">scan_dev_for_scripts</span><span class="o">=</span><span class="k">for</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">boot_scripts</span><span class="p">};</span><span class="w"> </span><span class="n">do</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">-</span><span class="n">e</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devtype</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">}:</span><span class="o">$</span><span class="p">{</span><span class="n">distro_bootpart</span><span class="p">}</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">prefix</span><span class="p">}</span><span class="o">$</span><span class="p">{</span><span class="n">script</span><span class="p">};</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">Found</span><span class="w"> </span><span class="n">U</span><span class="o">-</span><span class="n">Boot</span><span class="w"> </span><span class="n">script</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">prefix</span><span class="p">}</span><span class="o">$</span><span class="p">{</span><span class="n">script</span><span class="p">};</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">boot_a_script</span><span class="p">;</span><span class="w"> </span><span class="n">echo</span><span class="w"> </span><span class="n">SCRIPT</span><span class="w"> </span><span class="n">FAILED</span><span class="p">:</span><span class="w"> </span><span class="n">continuing</span><span class="o">...</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span><span class="p">;</span><span class="w"> </span><span class="n">done</span>
<span class="n">scriptaddr</span><span class="o">=</span><span class="mh">0x60500000</span>
<span class="n">scriptaddr1</span><span class="o">=</span><span class="mh">0x60500000</span>
<span class="n">serial</span><span class="c1">#=c3d9b8674f4b94f6</span>
<span class="n">soc</span><span class="o">=</span><span class="n">rockchip</span>
<span class="n">stderr</span><span class="o">=</span><span class="n">serial</span><span class="p">,</span><span class="n">vidconsole</span>
<span class="n">stdout</span><span class="o">=</span><span class="n">serial</span><span class="p">,</span><span class="n">vidconsole</span>
<span class="n">usb_boot</span><span class="o">=</span><span class="n">usb</span><span class="w"> </span><span class="n">start</span><span class="p">;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">usb</span><span class="w"> </span><span class="n">dev</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">devnum</span><span class="p">};</span><span class="w"> </span><span class="n">then</span><span class="w"> </span><span class="n">setenv</span><span class="w"> </span><span class="n">devtype</span><span class="w"> </span><span class="n">usb</span><span class="p">;</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="n">scan_dev_for_boot_part</span><span class="p">;</span><span class="w"> </span><span class="n">fi</span>
<span class="n">vendor</span><span class="o">=</span><span class="n">rockchip</span>

<span class="n">Environment</span><span class="w"> </span><span class="n">size</span><span class="p">:</span><span class="w"> </span><span class="mi">3477</span><span class="o">/</span><span class="mi">32764</span><span class="w"> </span><span class="n">bytes</span>
<span class="o">=&gt;</span><span class="w"> </span>
</code></pre></div>

<p>There are a few variables of interest that I'd like to point out in the table below:</p>
<p>{:class="table table-bordered"}
|----------+-----------|
| Variable | Significance |<br>
| :-------: | :------------: |<br>
|----------+-----------|
| <code>bootcmd</code> | This command is used to define the default boot behavior | 
|----------+-----------|
| <code>board=evb_rk3128</code> | This identifies the CPU / development board in use | 
|----------+-----------|
| <code>devtype=spinand</code> | This defines the flash device type in use | </p>
<p>At this point, if we cross-reference the information that we gathered during our hardware review, we see consistent results. We assumed after our hardware review that the SPI flash was the main method of storage, and this assumption is being validated in the UBoot environment variables and the available commands. </p>
<p>Let's start by examining the <code>rksfc</code> commands; a quick <a href="https://gitlab.collabora.com/nicolas/rockchip-uboot/blob/d5f538dc02e53c7267fcd4a914104071fca889b5/doc/README.rksfc">google search</a> tells us that this is RockChip's SPI SFC (serial flash controller) interface tool. This command has the following subcommands available:</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span><span class="w"> </span><span class="n">rksfc</span>
<span class="n">rksfc</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">rockchip</span><span class="w"> </span><span class="n">sfc</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="k">system</span>

<span class="k">Usage</span><span class="err">:</span>
<span class="n">rksfc</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">scan</span><span class="w"> </span><span class="n">Sfc</span><span class="w"> </span><span class="n">devices</span>
<span class="n">rksfc</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">Sfc</span><span class="w"> </span><span class="n">devices</span>
<span class="n">rksfc</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">[</span><span class="n">dev</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="k">current</span><span class="w"> </span><span class="n">Sfc</span><span class="w"> </span><span class="n">device</span>
<span class="w">    </span><span class="n">dev</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">spinand</span>
<span class="w">    </span><span class="n">dev</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">spinor</span>
<span class="n">rksfc</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="o">[</span><span class="n">dev</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">print</span><span class="w"> </span><span class="k">partition</span><span class="w"> </span><span class="nc">table</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="n">Sfc</span><span class="w"> </span><span class="n">devices</span>
<span class="n">rksfc</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="n">blk</span><span class="err">#</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">read</span><span class="w"> </span><span class="err">`</span><span class="n">cnt</span><span class="s1">&#39; blocks starting at block</span>
<span class="s1">    `blk#&#39;</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="err">`</span><span class="n">addr</span><span class="s1">&#39;</span>
<span class="s1">rksfc write addr blk# cnt - write `cnt&#39;</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">block</span>
<span class="w">    </span><span class="err">`</span><span class="n">blk</span><span class="err">#</span><span class="s1">&#39; from memory address `addr&#39;</span>
</code></pre></div>

<p>We can get the information about the SPI flash with the following commands:</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span><span class="w"> </span><span class="nx">rksfc</span><span class="w"> </span><span class="nx">scan</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="nx">rksfc</span><span class="w"> </span><span class="nx">info</span>
<span class="nx">Device</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nx">Vendor</span><span class="p">:</span><span class="w"> </span><span class="mh">0x0308</span><span class="w"> </span><span class="nx">Rev</span><span class="p">:</span><span class="w"> </span><span class="nx">V1</span><span class="m m-Double">.00</span><span class="w"> </span><span class="nx">Prod</span><span class="p">:</span><span class="w"> </span><span class="nx">rkflash</span><span class="o">-</span><span class="nx">SpiNand</span>
<span class="w">            </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">Hard</span><span class="w"> </span><span class="nx">Disk</span>
<span class="w">            </span><span class="nx">Capacity</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">107.7</span><span class="w"> </span><span class="nx">MB</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m m-Double">0.1</span><span class="w"> </span><span class="nx">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">220672</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="mi">512</span><span class="p">)</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="nx">rksfc</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="mi">0</span>

<span class="nx">Device</span><span class="w"> </span><span class="mi">0</span><span class="p">:</span><span class="w"> </span><span class="nx">Vendor</span><span class="p">:</span><span class="w"> </span><span class="mh">0x0308</span><span class="w"> </span><span class="nx">Rev</span><span class="p">:</span><span class="w"> </span><span class="nx">V1</span><span class="m m-Double">.00</span><span class="w"> </span><span class="nx">Prod</span><span class="p">:</span><span class="w"> </span><span class="nx">rkflash</span><span class="o">-</span><span class="nx">SpiNand</span>
<span class="w">            </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">Hard</span><span class="w"> </span><span class="nx">Disk</span>
<span class="w">            </span><span class="nx">Capacity</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">107.7</span><span class="w"> </span><span class="nx">MB</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="m m-Double">0.1</span><span class="w"> </span><span class="nx">GB</span><span class="w"> </span><span class="p">(</span><span class="mi">220672</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="mi">512</span><span class="p">)</span>
<span class="o">...</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="nx">current</span><span class="w"> </span><span class="nx">device</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="nx">rksfc</span><span class="w"> </span><span class="nx">part</span><span class="w"> </span><span class="mi">0</span>

<span class="nx">Partition</span><span class="w"> </span><span class="nx">Map</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">SPINAND</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="mi">0</span><span class="w">  </span><span class="o">--</span><span class="w">   </span><span class="nx">Partition</span><span class="w"> </span><span class="nx">Type</span><span class="p">:</span><span class="w"> </span><span class="nx">EFI</span>

<span class="nx">Part</span><span class="w">  </span><span class="nx">Start</span><span class="w"> </span><span class="nx">LBA</span><span class="w"> </span><span class="nx">End</span><span class="w"> </span><span class="nx">LBA</span><span class="w">   </span><span class="nx">Name</span>
<span class="w">  </span><span class="nx">Attributes</span>
<span class="w">  </span><span class="nx">Type</span><span class="w"> </span><span class="nx">GUID</span>
<span class="w">  </span><span class="nx">Partition</span><span class="w"> </span><span class="nx">GUID</span>
<span class="w">  </span><span class="mi">1</span><span class="w"> </span><span class="mh">0x00002000</span><span class="w">  </span><span class="mh">0x00003fff</span><span class="w">  </span><span class="s">&quot;uboot&quot;</span>
<span class="w">  </span><span class="nx">attrs</span><span class="p">:</span><span class="w">  </span><span class="mh">0x0000000000000000</span>
<span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">ea450000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">424</span><span class="nx">f</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">0</span><span class="nx">cd500004c0a</span>
<span class="w">  </span><span class="nx">guid</span><span class="p">:</span><span class="w"> </span><span class="mi">325</span><span class="nx">b0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4</span><span class="nx">d21</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">6</span><span class="nx">e10000051c5</span>
<span class="w">  </span><span class="mi">2</span><span class="w"> </span><span class="mh">0x00004000</span><span class="w">  </span><span class="mh">0x00004fff</span><span class="w">  </span><span class="s">&quot;trust&quot;</span>
<span class="w">  </span><span class="nx">attrs</span><span class="p">:</span><span class="w">  </span><span class="mh">0x0000000000000000</span>
<span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">b44a0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4121</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">4</span><span class="nx">e1600002902</span>
<span class="w">  </span><span class="nx">guid</span><span class="p">:</span><span class="w"> </span><span class="mi">62500000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4</span><span class="nx">f7f</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">4</span><span class="nx">a7800006ca1</span>
<span class="w">  </span><span class="mi">3</span><span class="w"> </span><span class="mh">0x00005000</span><span class="w">  </span><span class="mh">0x000097ff</span><span class="w">  </span><span class="s">&quot;boot&quot;</span>
<span class="w">  </span><span class="nx">attrs</span><span class="p">:</span><span class="w">  </span><span class="mh">0x0000000000000000</span>
<span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="nx">c1e0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4833</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">5</span><span class="nx">d07000065c4</span>
<span class="w">  </span><span class="nx">guid</span><span class="p">:</span><span class="w"> </span><span class="mi">442</span><span class="nx">c0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4</span><span class="nx">c4c</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">2</span><span class="nx">ed400005ecb</span>
<span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="mh">0x00009800</span><span class="w">  </span><span class="mh">0x00031dff</span><span class="w">  </span><span class="s">&quot;rootfs&quot;</span>
<span class="w">  </span><span class="nx">attrs</span><span class="p">:</span><span class="w">  </span><span class="mh">0x0000000000000000</span>
<span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="mi">9</span><span class="nx">b050000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4</span><span class="nx">e44</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">5</span><span class="nx">f3000007157</span>
<span class="w">  </span><span class="nx">guid</span><span class="p">:</span><span class="w"> </span><span class="mi">614</span><span class="nx">e0000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4</span><span class="nx">b53</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">1</span><span class="nx">d28000054a9</span>
<span class="w">  </span><span class="mi">5</span><span class="w"> </span><span class="mh">0x00031e00</span><span class="w">  </span><span class="mh">0x00035dde</span><span class="w">  </span><span class="s">&quot;userdata&quot;</span>
<span class="w">  </span><span class="nx">attrs</span><span class="p">:</span><span class="w">  </span><span class="mh">0x0000000000000000</span>
<span class="w">  </span><span class="k">type</span><span class="p">:</span><span class="w"> </span><span class="nx">c8050000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">4</span><span class="nx">b18</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">3</span><span class="nx">b1a000041c3</span>
<span class="w">  </span><span class="nx">guid</span><span class="p">:</span><span class="w"> </span><span class="mi">40780000</span><span class="o">-</span><span class="mi">0000</span><span class="o">-</span><span class="mi">493</span><span class="nx">e</span><span class="o">-</span><span class="mi">8000</span><span class="o">-</span><span class="mi">688900001525</span>
<span class="o">=&gt;</span><span class="w"> </span>
</code></pre></div>

<p>Using these commands, we can learn more about the SPI flash. We can see that the block size is 512 and that the chip contains a total of 220672 (0x35E00) blocks separated into five partitions:</p>
<ul>
<li>uboot - Likely contains our UBoot image / first stage bootloader</li>
<li>trust - Trusted execution environment image</li>
<li>boot - Kernel image / ramdisk</li>
<li>rootfs - Our largest partition, the root filesystem of the kernel</li>
<li>user data - User-specific data, likely used for high scores, user settings, etc</li>
</ul>
<p>Note that this data matches what we saw earlier from the root console prompt. We now understand how the flash is partitioned and what data might be available, but how can we read/write this data without soldering additional lines to the board? If we examine the <code>usb</code> command, we see the following:</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span><span class="w"> </span><span class="n">usb</span>
<span class="n">usb</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">sub</span><span class="o">-</span><span class="k">system</span>

<span class="k">Usage</span><span class="err">:</span>
<span class="n">usb</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">start</span><span class="w"> </span><span class="p">(</span><span class="n">scan</span><span class="p">)</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">controller</span>
<span class="n">usb</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">reset</span><span class="w"> </span><span class="p">(</span><span class="n">rescan</span><span class="p">)</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">controller</span>
<span class="n">usb</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="o">[</span><span class="n">f</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">stop</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="o">[</span><span class="n">f</span><span class="o">]=</span><span class="n">force</span><span class="w"> </span><span class="n">stop</span>
<span class="n">usb</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">tree</span>
<span class="n">usb</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">[</span><span class="n">dev</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">devices</span>
<span class="n">usb</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="o">[</span><span class="n">dev</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">port</span><span class="o">]</span><span class="w"> </span><span class="o">[</span><span class="n">mode</span><span class="o">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">set</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="n">test</span><span class="w"> </span><span class="n">mode</span>
<span class="w">    </span><span class="p">(</span><span class="n">specify</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">indicate</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">device</span><span class="s1">&#39;s upstream port)</span>
<span class="s1">    Available modes: J, K, S[E0_NAK], P[acket], F[orce_Enable]</span>
<span class="s1">usb storage - show details of USB storage devices</span>
<span class="s1">usb dev [dev] - show or set current USB storage device</span>
<span class="s1">usb part [dev] - print partition table of one or all USB storage    devices</span>
<span class="s1">usb read addr blk# cnt - read `cnt&#39;</span><span class="w"> </span><span class="n">blocks</span><span class="w"> </span><span class="n">starting</span><span class="w"> </span><span class="k">at</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="err">`</span><span class="n">blk</span><span class="err">#</span><span class="s1">&#39;</span>
<span class="s1">    to memory address `addr&#39;</span>
<span class="n">usb</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="n">addr</span><span class="w"> </span><span class="n">blk</span><span class="err">#</span><span class="w"> </span><span class="n">cnt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">write</span><span class="w"> </span><span class="err">`</span><span class="n">cnt</span><span class="s1">&#39; blocks starting at block `blk#&#39;</span>
<span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">memory</span><span class="w"> </span><span class="n">address</span><span class="w"> </span><span class="err">`</span><span class="n">addr</span><span class="err">&#39;</span>
</code></pre></div>

<p>Using the USB port on the side of the cabinet, if we insert a device and run <code>USB start</code> followed by <code>USB info</code> the following output is generated:</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span><span class="w"> </span><span class="n">usb</span><span class="w"> </span><span class="n">start</span>
<span class="n">starting</span><span class="w"> </span><span class="n">USB</span><span class="p">...</span>
<span class="n">Bus</span><span class="w"> </span><span class="n">usb</span><span class="mi">@10180000</span><span class="o">:</span><span class="w"> </span><span class="n">Bus</span><span class="w"> </span><span class="n">usb</span><span class="mi">@101</span><span class="n">c0000</span><span class="o">:</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">EHCI</span><span class="w"> </span><span class="mf">1.00</span>
<span class="n">Bus</span><span class="w"> </span><span class="n">usb</span><span class="mf">@101e0000</span><span class="o">:</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">OHCI</span><span class="w"> </span><span class="mf">1.0</span>
<span class="n">scanning</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">usb</span><span class="mi">@10180000</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">devices</span><span class="p">...</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">Device</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">found</span>
<span class="n">scanning</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">usb</span><span class="mi">@101</span><span class="n">c0000</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">devices</span><span class="p">...</span><span class="w"> </span><span class="n">RKPARM</span><span class="o">:</span><span class="w"> </span><span class="n">Invalid</span><span class="w"> </span><span class="n">parameter</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="n">table</span>
<span class="mi">2</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">Device</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">found</span>
<span class="n">scanning</span><span class="w"> </span><span class="n">bus</span><span class="w"> </span><span class="n">usb</span><span class="mf">@101e0000</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">devices</span><span class="p">...</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">USB</span><span class="w"> </span><span class="n">Device</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">found</span>
<span class="w">       </span><span class="n">scanning</span><span class="w"> </span><span class="n">usb</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">storage</span><span class="w"> </span><span class="n">devices</span><span class="p">...</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Storage</span><span class="w"> </span><span class="n">Device</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="n">found</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="n">usb</span><span class="w"> </span><span class="n">info</span>
<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">Hub</span><span class="p">,</span><span class="w">  </span><span class="n">USB</span><span class="w"> </span><span class="n">Revision</span><span class="w"> </span><span class="mf">1.10</span>
<span class="w"> </span><span class="o">-</span><span class="w">  </span><span class="n">U</span><span class="o">-</span><span class="n">Boot</span><span class="w"> </span><span class="n">Root</span><span class="w"> </span><span class="n">Hub</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="o">:</span><span class="w"> </span><span class="n">Hub</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PacketSize</span><span class="o">:</span><span class="w"> </span><span class="mi">8</span><span class="w">  </span><span class="n">Configurations</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vendor</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0000</span><span class="w">  </span><span class="n">Product</span><span class="w"> </span><span class="mh">0x0000</span><span class="w"> </span><span class="n">Version</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">   </span><span class="nl">Configuration</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Interfaces</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Self</span><span class="w"> </span><span class="n">Powered</span><span class="w"> </span><span class="mi">0</span><span class="n">mA</span>
<span class="w">     </span><span class="nl">Interface</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Alternate</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Endpoints</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="w"> </span><span class="n">Hub</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Endpoint</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">Interrupt</span><span class="w"> </span><span class="n">MaxPacket</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">Interval</span><span class="w"> </span><span class="mi">255</span><span class="n">ms</span>

<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">Hub</span><span class="p">,</span><span class="w">  </span><span class="n">USB</span><span class="w"> </span><span class="n">Revision</span><span class="w"> </span><span class="mf">2.0</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">u</span><span class="o">-</span><span class="n">boot</span><span class="w"> </span><span class="n">EHCI</span><span class="w"> </span><span class="n">Host</span><span class="w"> </span><span class="n">Controller</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="o">:</span><span class="w"> </span><span class="n">Hub</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PacketSize</span><span class="o">:</span><span class="w"> </span><span class="mi">64</span><span class="w">  </span><span class="n">Configurations</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vendor</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0000</span><span class="w">  </span><span class="n">Product</span><span class="w"> </span><span class="mh">0x0000</span><span class="w"> </span><span class="n">Version</span><span class="w"> </span><span class="mf">1.0</span>
<span class="w">   </span><span class="nl">Configuration</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Interfaces</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Self</span><span class="w"> </span><span class="n">Powered</span><span class="w"> </span><span class="mi">0</span><span class="n">mA</span>
<span class="w">     </span><span class="nl">Interface</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Alternate</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Endpoints</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="w"> </span><span class="n">Hub</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Endpoint</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">Interrupt</span><span class="w"> </span><span class="n">MaxPacket</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">Interval</span><span class="w"> </span><span class="mi">255</span><span class="n">ms</span>

<span class="mi">2</span><span class="o">:</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">Storage</span><span class="p">,</span><span class="w">  </span><span class="n">USB</span><span class="w"> </span><span class="n">Revision</span><span class="w"> </span><span class="mf">2.10</span>
<span class="w"> </span><span class="o">-</span><span class="w">          </span><span class="n">USB</span><span class="w"> </span><span class="n">DISK</span><span class="w"> </span><span class="mf">3.0</span><span class="w"> </span><span class="mo">071</span><span class="mi">9146</span><span class="n">D1CBF9257</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">from</span><span class="w"> </span><span class="n">Interface</span><span class="p">)</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">Storage</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PacketSize</span><span class="o">:</span><span class="w"> </span><span class="mi">64</span><span class="w">  </span><span class="n">Configurations</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vendor</span><span class="o">:</span><span class="w"> </span><span class="mh">0x13fe</span><span class="w">  </span><span class="n">Product</span><span class="w"> </span><span class="mh">0x6300</span><span class="w"> </span><span class="n">Version</span><span class="w"> </span><span class="mf">1.0</span>
<span class="w">   </span><span class="nl">Configuration</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Interfaces</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Bus</span><span class="w"> </span><span class="n">Powered</span><span class="w"> </span><span class="mi">498</span><span class="n">mA</span>
<span class="w">     </span><span class="nl">Interface</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Alternate</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Endpoints</span><span class="o">:</span><span class="w"> </span><span class="mi">2</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="w"> </span><span class="n">Mass</span><span class="w"> </span><span class="n">Storage</span><span class="p">,</span><span class="w"> </span><span class="n">Transp</span><span class="p">.</span><span class="w"> </span><span class="n">SCSI</span><span class="p">,</span><span class="w"> </span><span class="n">Bulk</span><span class="w"> </span><span class="n">only</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Endpoint</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">Bulk</span><span class="w"> </span><span class="n">MaxPacket</span><span class="w"> </span><span class="mi">512</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Endpoint</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">Out</span><span class="w"> </span><span class="n">Bulk</span><span class="w"> </span><span class="n">MaxPacket</span><span class="w"> </span><span class="mi">512</span>

<span class="mi">1</span><span class="o">:</span><span class="w"> </span><span class="n">Hub</span><span class="p">,</span><span class="w">  </span><span class="n">USB</span><span class="w"> </span><span class="n">Revision</span><span class="w"> </span><span class="mf">1.10</span>
<span class="w"> </span><span class="o">-</span><span class="w">  </span><span class="n">U</span><span class="o">-</span><span class="n">Boot</span><span class="w"> </span><span class="n">Root</span><span class="w"> </span><span class="n">Hub</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="o">:</span><span class="w"> </span><span class="n">Hub</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">PacketSize</span><span class="o">:</span><span class="w"> </span><span class="mi">8</span><span class="w">  </span><span class="n">Configurations</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Vendor</span><span class="o">:</span><span class="w"> </span><span class="mh">0x0000</span><span class="w">  </span><span class="n">Product</span><span class="w"> </span><span class="mh">0x0000</span><span class="w"> </span><span class="n">Version</span><span class="w"> </span><span class="mf">0.0</span>
<span class="w">   </span><span class="nl">Configuration</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="o">-</span><span class="w"> </span><span class="n">Interfaces</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">Self</span><span class="w"> </span><span class="n">Powered</span><span class="w"> </span><span class="mi">0</span><span class="n">mA</span>
<span class="w">     </span><span class="nl">Interface</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Alternate</span><span class="w"> </span><span class="n">Setting</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">Endpoints</span><span class="o">:</span><span class="w"> </span><span class="mi">1</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="kt">Class</span><span class="w"> </span><span class="n">Hub</span>
<span class="w">     </span><span class="o">-</span><span class="w"> </span><span class="n">Endpoint</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="n">In</span><span class="w"> </span><span class="n">Interrupt</span><span class="w"> </span><span class="n">MaxPacket</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">Interval</span><span class="w"> </span><span class="mi">255</span><span class="n">ms</span>
</code></pre></div>

<p>Excellent, we can see that the USB stack enumerates successfully and detects our mass storage device.</p>
<p>Before we continue, let's review what we know about our UBoot environment:</p>
<ol>
<li>Examining the environment variables gave us usable addresses in RAM </li>
<li>Using the <code>rksfc read</code> utility, we can read SPI flash sectors into RAM</li>
<li>Using the USB commands, we can enumerate a USB device and write to it</li>
</ol>
<p>We could read the  SPI flash into RAM, attach a USB device, and then write the SPI flash data to the USB device using the <code>USB write</code> command. If this method works, we should also be able to recover the flash images by inverting the steps, reading data from the USB drive, and writing it back to flash using <code>rksfc write</code>. Let's start by testing a read.</p>
<p>First, we will try to read the entire SPI flash into RAM with the following command for our destination address we will try the address stored in <code>$ramdisk_addr_r</code> which is <code>0x6a200000</code>:</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span><span class="w"> </span><span class="nx">rksfc</span><span class="w"> </span><span class="nx">read</span><span class="w"> </span><span class="err">$</span><span class="nx">ramdisk_addr_r</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mh">0x35E00</span>

<span class="nx">spinand</span><span class="w"> </span><span class="nx">read</span><span class="p">:</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="nx">undefined</span><span class="w"> </span><span class="nx">instruction</span>
<span class="nx">pc</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">ce695528</span><span class="w">  </span><span class="nx">lr</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="nx">fadca4d</span>
<span class="nx">sp</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="nx">be17bd8</span><span class="w">  </span><span class="nx">ip</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">00000020</span><span class="w">     </span><span class="nx">fp</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">60093204</span>
<span class="nx">r10</span><span class="p">:</span><span class="w"> </span><span class="mi">00004254</span><span class="w">  </span><span class="nx">r9</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">6</span><span class="nx">be1bdf8</span><span class="w">     </span><span class="nx">r8</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">ad758c77</span>
<span class="nx">r7</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">ebaa79cb</span><span class="w">  </span><span class="nx">r6</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">b052b720</span><span class="w">     </span><span class="nx">r5</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">36395</span><span class="nx">b84</span><span class="w">  </span><span class="nx">r4</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="nx">f3a911be</span>
<span class="nx">r3</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">780</span><span class="nx">fb750</span><span class="w">  </span><span class="nx">r2</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">00000000</span><span class="w">     </span><span class="nx">r1</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">600</span><span class="nx">a62fc</span><span class="w">  </span><span class="nx">r0</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="nx">a226c</span>
<span class="nx">Flags</span><span class="p">:</span><span class="w"> </span><span class="nx">nZcv</span><span class="w">  </span><span class="nx">IRQs</span><span class="w"> </span><span class="nx">on</span><span class="w">  </span><span class="nx">FIQs</span><span class="w"> </span><span class="nx">off</span><span class="w">  </span><span class="nx">Mode</span><span class="w"> </span><span class="nx">SVC_32</span>


<span class="nx">Call</span><span class="w"> </span><span class="nx">trace</span><span class="p">:</span>
<span class="w">  </span><span class="nx">PC</span><span class="p">:</span><span class="w">   </span><span class="p">[&lt;</span><span class="w"> </span><span class="nx">ce695528</span><span class="w"> </span><span class="p">&gt;]</span>
<span class="w">  </span><span class="nx">LR</span><span class="p">:</span><span class="w">   </span><span class="p">[&lt;</span><span class="w"> </span><span class="mi">1</span><span class="nx">fadca4d</span><span class="w"> </span><span class="p">&gt;]</span>

<span class="nx">Stack</span><span class="p">:</span>
<span class="w">        </span><span class="p">[&lt;</span><span class="w"> </span><span class="nx">ce695528</span><span class="w"> </span><span class="p">&gt;]</span>

<span class="nx">Copy</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="nx">from</span><span class="w"> </span><span class="s">&quot;Call trace...&quot;</span><span class="w"> </span><span class="nx">to</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">file</span><span class="p">(</span><span class="nx">eg</span><span class="p">.</span><span class="w"> </span><span class="nx">dump</span><span class="p">.</span><span class="nx">txt</span><span class="p">),</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="nx">run</span>
<span class="nx">command</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">U</span><span class="o">-</span><span class="nx">Boot</span><span class="w"> </span><span class="nx">project</span><span class="p">:</span><span class="w"> </span><span class="p">.</span><span class="o">/</span><span class="nx">scripts</span><span class="o">/</span><span class="nx">stacktrace</span><span class="p">.</span><span class="nx">sh</span><span class="w"> </span><span class="nx">dump</span><span class="p">.</span><span class="nx">txt</span>

<span class="nx">Resetting</span><span class="w"> </span><span class="nx">CPU</span><span class="w"> </span><span class="o">...</span>

<span class="err">###</span><span class="w"> </span><span class="nx">ERROR</span><span class="w"> </span><span class="err">###</span><span class="w"> </span><span class="nx">Please</span><span class="w"> </span><span class="nx">RESET</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">board</span><span class="w"> </span><span class="err">###</span>
</code></pre></div>

<p>This didn't work; we somehow triggered an undefined instruction exception. We likely clobbered something in that UBoot was utilizing; let's see what happens when we try another address that is lower in memory:</p>
<div class="highlight"><pre><span></span><code><span class="o">=&gt;</span><span class="w"> </span><span class="nx">rksfc</span><span class="w"> </span><span class="nx">read</span><span class="w"> </span><span class="err">$</span><span class="nx">scriptaddr</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mh">0x35E00</span>

<span class="nx">spinand</span><span class="w"> </span><span class="nx">read</span><span class="p">:</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">read</span><span class="p">:</span><span class="w"> </span><span class="nx">OK</span>
</code></pre></div>

<p>Moving to a lower address in RAM allowed the read to complete without clobbering anything; let's see if we can now write this data back to the USB drive:</p>
<div class="highlight"><pre><span></span><code><span class="nx">usb</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="kd">addr</span><span class="w"> </span><span class="nx">blk</span><span class="err">#</span><span class="w"> </span><span class="nx">cnt</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="err">`</span><span class="nx">cnt</span><span class="err">&#39;</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">starting</span><span class="w"> </span><span class="nx">at</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="err">`</span><span class="nx">blk</span><span class="err">#&#39;</span>
<span class="w">    </span><span class="nx">from</span><span class="w"> </span><span class="nx">memory</span><span class="w"> </span><span class="nx">address</span><span class="w"> </span><span class="err">`</span><span class="kd">addr</span><span class="err">&#39;</span>
<span class="o">=&gt;</span><span class="w"> </span><span class="nx">usb</span><span class="w"> </span><span class="nx">write</span><span class="w"> </span><span class="err">$</span><span class="nx">scriptaddr</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mh">0x35E00</span>

<span class="nx">usb</span><span class="w"> </span><span class="nx">write</span><span class="p">:</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">written</span><span class="p">:</span><span class="w"> </span><span class="nx">OK</span>
<span class="o">=&gt;</span>
</code></pre></div>

<p>Now let's take a look at the contents of this drive by inserting it into the Raspberry Pi and see what we have:</p>
<div class="highlight"><pre><span></span><code><span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">lsblk</span>
<span class="n">NAME</span><span class="w">        </span><span class="nl">MAJ</span><span class="p">:</span><span class="nf">MIN</span><span class="w"> </span><span class="n">RM</span><span class="w">  </span><span class="k">SIZE</span><span class="w"> </span><span class="n">RO</span><span class="w"> </span><span class="n">TYPE</span><span class="w"> </span><span class="n">MOUNTPOINT</span>
<span class="n">sda</span><span class="w">           </span><span class="mi">8</span><span class="err">:</span><span class="mi">0</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="mf">57.8</span><span class="n">G</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="k">disk</span>
<span class="err">â”œâ”€</span><span class="n">sda1</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">1</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">4</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda2</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">2</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda3</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">3</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">9</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda4</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">4</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="mf">80.8</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â””â”€</span><span class="n">sda5</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">5</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">8</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
</code></pre></div>

<p>Here we can see that the partition table on our USB drive matches what was displayed in the output of the <code>rksfc part 0</code> command. Next, we will use the <code>dd</code> utility to extract the various partitions for analysis.</p>
<div class="highlight"><pre><span></span><code><span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda1</span><span class="w"> </span><span class="k">of</span><span class="o">=</span><span class="n">part1</span><span class="p">.</span><span class="n">bin</span>
<span class="mi">4194304</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="mf">4.2</span><span class="w"> </span><span class="n">MB</span><span class="p">,</span><span class="w"> </span><span class="mf">4.0</span><span class="w"> </span><span class="n">MiB</span><span class="p">)</span><span class="w"> </span><span class="n">copied</span><span class="p">,</span><span class="w"> </span><span class="mf">0.18225</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">23.0</span><span class="w"> </span><span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda2</span><span class="w"> </span><span class="k">of</span><span class="o">=</span><span class="n">part2</span><span class="p">.</span><span class="n">bin</span>
<span class="mi">2097152</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="mf">2.1</span><span class="w"> </span><span class="n">MB</span><span class="p">,</span><span class="w"> </span><span class="mf">2.0</span><span class="w"> </span><span class="n">MiB</span><span class="p">)</span><span class="w"> </span><span class="n">copied</span><span class="p">,</span><span class="w"> </span><span class="mf">0.109297</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">19.2</span><span class="w"> </span><span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda3</span><span class="w"> </span><span class="k">of</span><span class="o">=</span><span class="n">part3</span><span class="p">.</span><span class="n">bin</span>
<span class="mi">9437184</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="mf">9.4</span><span class="w"> </span><span class="n">MB</span><span class="p">,</span><span class="w"> </span><span class="mf">9.0</span><span class="w"> </span><span class="n">MiB</span><span class="p">)</span><span class="w"> </span><span class="n">copied</span><span class="p">,</span><span class="w"> </span><span class="mf">0.386968</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">24.4</span><span class="w"> </span><span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda4</span><span class="w"> </span><span class="k">of</span><span class="o">=</span><span class="n">part4</span><span class="p">.</span><span class="n">bin</span>
<span class="mi">84672512</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="mi">85</span><span class="w"> </span><span class="n">MB</span><span class="p">,</span><span class="w"> </span><span class="mi">81</span><span class="w"> </span><span class="n">MiB</span><span class="p">)</span><span class="w"> </span><span class="n">copied</span><span class="p">,</span><span class="w"> </span><span class="mf">2.96481</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">28.6</span><span class="w"> </span><span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">sudo</span><span class="w"> </span><span class="n">dd</span><span class="w"> </span><span class="k">if</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda5</span><span class="w"> </span><span class="k">of</span><span class="o">=</span><span class="n">part5</span><span class="p">.</span><span class="n">bin</span>
<span class="mi">8371712</span><span class="w"> </span><span class="n">bytes</span><span class="w"> </span><span class="p">(</span><span class="mf">8.4</span><span class="w"> </span><span class="n">MB</span><span class="p">,</span><span class="w"> </span><span class="mf">8.0</span><span class="w"> </span><span class="n">MiB</span><span class="p">)</span><span class="w"> </span><span class="n">copied</span><span class="p">,</span><span class="w"> </span><span class="mf">0.314125</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="mf">26.7</span><span class="w"> </span><span class="n">MB</span><span class="o">/</span><span class="n">s</span>
<span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="o">*</span>
<span class="n">part1</span><span class="p">.</span><span class="nl">bin</span><span class="p">:</span><span class="w"> </span><span class="k">data</span>
<span class="n">part2</span><span class="p">.</span><span class="nl">bin</span><span class="p">:</span><span class="w"> </span><span class="k">data</span>
<span class="n">part3</span><span class="p">.</span><span class="nl">bin</span><span class="p">:</span><span class="w"> </span><span class="n">Android</span><span class="w"> </span><span class="n">bootimg</span><span class="p">,</span><span class="w"> </span><span class="n">kernel</span><span class="w"> </span><span class="p">(</span><span class="mh">0x10008000</span><span class="p">),</span><span class="w"> </span><span class="k">second</span><span class="w"> </span><span class="n">stage</span><span class="w"> </span><span class="p">(</span><span class="mh">0x10f00000</span><span class="p">),</span><span class="w"> </span><span class="n">page</span><span class="w"> </span><span class="k">size</span><span class="err">:</span><span class="w"> </span><span class="mi">2048</span>
<span class="n">part4</span><span class="p">.</span><span class="nl">bin</span><span class="p">:</span><span class="w"> </span><span class="n">Squashfs</span><span class="w"> </span><span class="n">filesystem</span><span class="p">,</span><span class="w"> </span><span class="n">little</span><span class="w"> </span><span class="n">endian</span><span class="p">,</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">4.0</span><span class="p">,</span><span class="w"> </span><span class="n">xz</span><span class="w"> </span><span class="n">compressed</span><span class="p">,</span><span class="w"> </span><span class="mi">71663599</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">1185</span><span class="w"> </span><span class="n">inodes</span><span class="p">,</span><span class="w"> </span><span class="nl">blocksize</span><span class="p">:</span><span class="w"> </span><span class="mi">131072</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="nl">created</span><span class="p">:</span><span class="w"> </span><span class="n">Mon</span><span class="w"> </span><span class="n">May</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">09</span><span class="err">:</span><span class="mi">06</span><span class="err">:</span><span class="mi">53</span><span class="w"> </span><span class="mi">2021</span>
<span class="n">part5</span><span class="p">.</span><span class="nl">bin</span><span class="p">:</span><span class="w"> </span><span class="n">Linux</span><span class="w"> </span><span class="n">rev</span><span class="w"> </span><span class="mf">1.0</span><span class="w"> </span><span class="n">ext2</span><span class="w"> </span><span class="n">filesystem</span><span class="w"> </span><span class="k">data</span><span class="w"> </span><span class="p">(</span><span class="n">mounted</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">unclean</span><span class="p">),</span><span class="w"> </span><span class="n">UUID</span><span class="o">=</span><span class="mi">42185</span><span class="n">cbc</span><span class="o">-</span><span class="n">b698</span><span class="o">-</span><span class="mi">4</span><span class="n">af6</span><span class="o">-</span><span class="mi">8</span><span class="n">a47</span><span class="o">-</span><span class="n">e444e5635787</span><span class="p">,</span><span class="w"> </span><span class="n">volume</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="ss">&quot;userdata&quot;</span><span class="w"> </span><span class="p">(</span><span class="k">large</span><span class="w"> </span><span class="n">files</span><span class="p">)</span>
</code></pre></div>

<p>Thus far, this data matches what we saw when looking at both the mount output on the running system and the partition table from the UBoot menu. Therefore, we can extract the squashfs partition via <code>unsquashfs</code> and attempt to mount the ext2 partition to confirm that they are valid:</p>
<div class="highlight"><pre><span></span><code><span class="n">pi</span><span class="err">@</span><span class="n">voidstar</span><span class="p">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">unsquashfs</span><span class="w"> </span><span class="n">part4</span><span class="o">.</span><span class="n">bin</span>
<span class="n">Parallel</span><span class="w"> </span><span class="n">unsquashfs</span><span class="p">:</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="n">four</span><span class="w"> </span><span class="n">processors</span>
<span class="mi">1029</span><span class="w"> </span><span class="n">inodes</span><span class="w"> </span><span class="p">(</span><span class="mi">1792</span><span class="w"> </span><span class="n">blocks</span><span class="p">)</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">write</span>
<span class="n">create_inode</span><span class="p">:</span><span class="w"> </span><span class="n">could</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">create</span><span class="w"> </span><span class="n">character</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="n">squashfs</span><span class="o">-</span><span class="n">root</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">console</span><span class="p">,</span><span class="w"> </span><span class="n">because</span><span class="w"> </span><span class="n">you</span><span class="s1">&#39;re not superuser!</span>
<span class="n">created</span><span class="w"> </span><span class="mi">596</span><span class="w"> </span><span class="n">files</span>
<span class="n">created</span><span class="w"> </span><span class="mi">157</span><span class="w"> </span><span class="n">directories</span>
<span class="n">created</span><span class="w"> </span><span class="mi">431</span><span class="w"> </span><span class="n">symlinks</span>
<span class="n">created</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">devices</span>
<span class="n">created</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">fifos</span>
<span class="n">pi</span><span class="err">@</span><span class="n">voidstar</span><span class="p">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">squashfs</span><span class="o">-</span><span class="n">root</span><span class="o">/</span>
<span class="n">bin</span><span class="w">  </span><span class="n">busybox</span><span class="o">.</span><span class="n">config</span><span class="w">  </span><span class="n">data</span><span class="w">  </span><span class="n">dev</span><span class="w">  </span><span class="n">etc</span><span class="w">  </span><span class="n">lib</span><span class="w">  </span><span class="n">lib32</span><span class="w">  </span><span class="n">linuxrc</span><span class="w">  </span><span class="n">media</span><span class="w">  </span><span class="n">misc</span><span class="w">  </span><span class="n">mnt</span><span class="w">  </span><span class="n">moo</span><span class="w">  </span><span class="n">OEM</span><span class="w">  </span><span class="n">opt</span><span class="w">  </span><span class="n">proc</span><span class="w">  </span><span class="n">root</span><span class="w">  </span><span class="n">run</span><span class="w">  </span><span class="n">sbin</span><span class="w">  </span><span class="n">sdcard</span><span class="w">  </span><span class="n">sys</span><span class="w">  </span><span class="n">timestamp</span><span class="w">  </span><span class="n">tmp</span><span class="w">  </span><span class="n">udisk</span><span class="w">  </span><span class="n">userdata</span><span class="w">  </span><span class="n">usr</span><span class="w">  </span><span class="k">var</span>
<span class="n">pi</span><span class="err">@</span><span class="n">voidstar</span><span class="p">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="n">squashfs</span><span class="o">-</span><span class="n">root</span><span class="o">/</span><span class="n">moo</span><span class="o">/</span>
<span class="n">docs</span><span class="w">  </span><span class="n">logo</span><span class="o">.</span><span class="n">mp4</span><span class="w">  </span><span class="n">MOO</span><span class="w">  </span><span class="n">MOO</span><span class="o">-</span><span class="n">Ship</span><span class="o">-</span><span class="n">MIME_CCADE_MSH_2P</span><span class="o">-</span><span class="n">BRK01</span><span class="w">  </span><span class="n">SKUShell</span><span class="o">.</span><span class="n">MIME_CCADE_SF2_2P</span><span class="o">.</span><span class="mf">19.</span><span class="n">exe</span><span class="w">  </span><span class="n">start</span><span class="o">.</span><span class="n">sh</span><span class="w">  </span><span class="n">_ui</span><span class="w">  </span><span class="n">assets</span>
</code></pre></div>

<p>It looks like we have a valid root filesystem, and we can now start reverse-engineering the software and learning more about how we might modify this system to play additional games or run custom firmware. </p>
<p>Now that we have confirmed that we can read the flash, let's test and see if we can write this image back to flash using the methods described above:</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nx">usb</span><span class="w"> </span><span class="nx">read</span><span class="w">  </span><span class="err">$</span><span class="nx">scriptaddr</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="mh">0x35E00</span>
<span class="w"> </span><span class="nx">usb</span><span class="w"> </span><span class="nx">read</span><span class="p">:</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">read</span><span class="p">:</span><span class="w"> </span><span class="nx">OK</span>
<span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nx">rksfc</span><span class="w"> </span><span class="nx">write</span><span class="w">  </span><span class="err">$</span><span class="nx">scriptaddr</span><span class="w"> </span><span class="mh">0x35E00</span><span class="w"> </span><span class="mi">0</span>
<span class="w"> </span><span class="nx">spinand</span><span class="w"> </span><span class="nx">write</span><span class="p">:</span><span class="w"> </span><span class="nx">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nx">block</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nx">count</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="o">...</span><span class="w"> </span><span class="mi">220672</span><span class="w"> </span><span class="nx">blocks</span><span class="w"> </span><span class="nx">written</span><span class="p">:</span><span class="w"> </span><span class="nx">OK</span>
</code></pre></div>

<p>Now we reboot, hoping that our reflashed image still works.</p>
<p><img alt="Rebooted Cabinet" src="https://voidstarsec.com/blog/assets/images/rebooted.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>Success! We can now read/write the SPI flash from UBoot using our USB drive; this will be useful for testing patches and firmware modifications!</p>
<p>Now that we can read/write the flash of this cabinet with UBoot, it would be great if we could wipe individual partitions and segments of flash automatically without needing to manually enter ranges each time. To do this, we will use the Depthcharge utility to automate our UBoot interactions!</p>
<h1>Scripting UBoot with Depthcharge</h1>
<p>When working with UBoot environments, we often need to automate our interactions. for example, in our case, we might want to automate the overwriting of a specific flash partition without having to manually enter the address offsets every time. Luckily for us, the folks over at <a href="https://twitter.com/NCCGroupInfosec">NCC Group</a> have put together a tool to help us with this called <a href="https://depthcharge.readthedocs.io/en/latest/">depthcharge</a>. We can use this to automate the process of reading data to and from our flash chip and external USB drive. Our script will need to do the following:</p>
<ol>
<li>Connect to the UART and identify the UBoot prompt</li>
<li>Read and write to the SPI flash using the <code>rksfc read/write</code> commands</li>
<li>Read and write to the USB drive using the <code>USB read/write</code> commands</li>
</ol>
<p>First, we need to install the module; we can install <code>depthcharge</code> on the Pi by executing: <code>sudo pip install depthcharge</code>.o</p>
<h2>Connect to the UART and identify the UBoot Prompt</h2>
<p>We can connect to our UBoot prompt using the following python code:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">console_setup</span><span class="p">():</span>
    <span class="n">console</span><span class="o">=</span><span class="n">Console</span><span class="p">(</span><span class="s2">&quot;/dev/ttyS0&quot;</span><span class="p">,</span><span class="n">baudrate</span><span class="o">=</span><span class="mi">115200</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">Depthcharge</span><span class="p">(</span><span class="n">console</span><span class="p">,</span><span class="n">arch</span><span class="o">=</span><span class="s2">&quot;arm&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ctx</span>
</code></pre></div>

<p>In the above function, we are creating a <code>Console</code> object, which requires that we provide a path to the serial port and the baud rate. This console object is then used to make a Depthcharge context which is what we will use to access the features that Depthcharge has to offer. <a href="https://depthcharge.readthedocs.io/en/latest/api/depthcharge.html">The depthcharge documentation</a> has a well-documented example of this and describes the setup process in detail. </p>
<h2>Flash reads and write via depthcharge</h2>
<p>Now that we have connected to our interface, we need to implement the <code>rksfc</code> read and write commands. We can do this using depthcharge's <code>send_command()</code> API. This API call allows us to generate and send a UBoot command to the command prompt and returns the response. In the example below, we construct our read command in the <code>cmd_str</code> variable and ensure that the arguments are formatted properly, then issue the command using the <code>send_command()</code> API.</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">rksfc_read</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">dest_addr</span><span class="p">,</span><span class="n">src_addr</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;rksfc read  0x</span><span class="si">{</span><span class="n">dest_addr</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">src_addr</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>

<span class="k">def</span> <span class="nf">rksfc_write</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">dest_addr</span><span class="p">,</span><span class="n">src_addr</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
    <span class="n">cmd_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;rksfc write 0x</span><span class="si">{</span><span class="n">dest_addr</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">src_addr</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">cmd_str</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>
</code></pre></div>

<p>We now have implemented our flash reads and writes next we need to enumerate the USB stack and then read/write from the flash drive.</p>
<h2>USB reads and write via depthcharge</h2>
<p>Similar to how we implemented the <code>rksfc</code> commands, we will next implement the <code>usb</code> commands. The process will be similar to that used for the <code>rksfc</code> commands:</p>
<div class="highlight"><pre><span></span><code><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">usb_setup</span>
<span class="sd">This script is used to enumerate and set up the USB port</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">def</span> <span class="nf">usb_setup</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">resps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">reset</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;usb start&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;usb reset&quot;</span><span class="p">)</span>
    <span class="n">resps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;usb storage&quot;</span><span class="p">)</span>
    <span class="n">resps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="s2">&quot;usb dev 0&quot;</span><span class="p">)</span>
    <span class="n">resps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resps</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">USB write addr blk# cnt - write `cnt&#39; blocks starting at block `blk#&#39;</span>
<span class="sd">    from memory address `addr&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">def</span> <span class="nf">usb_raw_write</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">source_addr</span><span class="p">,</span><span class="n">block</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;usb write 0x</span><span class="si">{</span><span class="n">source_addr</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">block</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">USB read addr blk# cnt - read `cnt&#39; blocks starting at block `blk#&#39;</span>
<span class="sd">    to memory address `addr&#39;</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="k">def</span> <span class="nf">usb_raw_read</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">source_addr</span><span class="p">,</span><span class="n">block</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
    <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;usb read 0x</span><span class="si">{</span><span class="n">source_addr</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">block</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">size</span><span class="si">:</span><span class="s2">x</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">resp</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">send_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">resp</span>
</code></pre></div>

<h2>Dumping the flash with Depthcharge</h2>
<p>Now that we have the appropriate functions defined, we can try the following:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Marvel Super Heroes Depthcharge Test...&quot;</span><span class="p">)</span>
    <span class="n">ctx</span> <span class="o">=</span> <span class="n">console_setup</span><span class="p">()</span>
    <span class="n">usb_setup</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Read the SPI flash into RAM</span>
    <span class="n">rksfc_read</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">TARGET_RAM_ADDR</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x35E00</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flash read into RAM&quot;</span><span class="p">)</span>
    <span class="c1"># Write the data from RAM to a USB drive</span>
    <span class="n">usb_raw_write</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="n">TARGET_RAM_ADDR</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mh">0x35E00</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Flash written to USB&quot;</span><span class="p">)</span>
</code></pre></div>

<p>If we run this script, we see the following output:</p>
<div class="highlight"><pre><span></span><code><span class="n">pi</span><span class="err">@</span><span class="n">voidstar</span><span class="p">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">scripts</span><span class="w"> </span><span class="o">$</span><span class="w"> </span><span class="n">python3</span><span class="w"> </span><span class="n">mvc</span><span class="o">.</span><span class="n">py</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Marvel</span><span class="w"> </span><span class="n">Super</span><span class="w"> </span><span class="n">Heroes</span><span class="w"> </span><span class="n">Deptcharge</span><span class="w"> </span><span class="n">Test</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Using</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="n">base</span><span class="w"> </span><span class="n">address</span><span class="p">:</span><span class="w"> </span><span class="o">$</span><span class="p">{</span><span class="n">loadaddr</span><span class="p">}</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">32</span><span class="n">MiB</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">user</span><span class="o">-</span><span class="n">specified</span><span class="w"> </span><span class="n">prompt</span><span class="w"> </span><span class="n">provided</span><span class="o">.</span><span class="w"> </span><span class="n">Attempting</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">determine</span><span class="w"> </span><span class="n">this</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Identified</span><span class="w"> </span><span class="n">prompt</span><span class="p">:</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Retrieving</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="n">list</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="s2">&quot;help&quot;</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Reading</span><span class="w"> </span><span class="n">environment</span><span class="w"> </span><span class="n">via</span><span class="w"> </span><span class="s2">&quot;printenv&quot;</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w"> </span><span class="n">Disabling</span><span class="w"> </span><span class="n">payload</span><span class="w"> </span><span class="n">deployment</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">execution</span><span class="w"> </span><span class="n">due</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">error</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Version</span><span class="p">:</span><span class="w"> </span><span class="n">U</span><span class="o">-</span><span class="n">Boot</span><span class="w"> </span><span class="mf">2017.09</span><span class="o">-</span><span class="n">g4857df5</span><span class="o">-</span><span class="n">dirty</span><span class="w"> </span><span class="c1">#lzy (Mar 24 2021 - 16:18:22 +0800)</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Enumerating</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">MemoryWriter</span><span class="w"> </span><span class="n">implementations</span><span class="o">...</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">CpMemoryWriter</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">CRC32MemoryWriter</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">I2CMemoryWriter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="s2">&quot;i2c&quot;</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">detected</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">LoadbMemoryWriter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="s2">&quot;loadb&quot;</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">detected</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">LoadxMemoryWriter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="s2">&quot;loadx&quot;</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">detected</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">LoadyMemoryWriter</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="s2">&quot;loady&quot;</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">detected</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">MmMemoryWriter</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">MwMemoryWriter</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">NmMemoryWriter</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Enumerating</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">MemoryReader</span><span class="w"> </span><span class="n">implementations</span><span class="o">...</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">CpCrashMemoryReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">CRC32MemoryReader</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">GoMemoryReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Payload</span><span class="w"> </span><span class="n">deployment</span><span class="o">+</span><span class="n">execution</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">I2CMemoryReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="s2">&quot;i2c&quot;</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">detected</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">ItestMemoryReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="s2">&quot;itest&quot;</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">detected</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">MdMemoryReader</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Available</span><span class="p">:</span><span class="w"> </span><span class="n">MmMemoryReader</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">SetexprMemoryReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="s2">&quot;setexpr&quot;</span><span class="w"> </span><span class="n">required</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">detected</span><span class="o">.</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Enumerating</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">Executor</span><span class="w"> </span><span class="n">implementations</span><span class="o">...</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">GoExecutor</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Payload</span><span class="w"> </span><span class="n">deployment</span><span class="o">+</span><span class="n">execution</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span>
<span class="p">[</span><span class="o">*</span><span class="p">]</span><span class="w"> </span><span class="n">Enumerating</span><span class="w"> </span><span class="n">available</span><span class="w"> </span><span class="n">RegisterReader</span><span class="w"> </span><span class="n">implementations</span><span class="o">...</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">CpCrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">CRC32CrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">FDTCrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">ItestCrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">MdCrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">MmCrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">NmCrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w">   </span><span class="n">Excluded</span><span class="p">:</span><span class="w">  </span><span class="n">SetexprCrashRegisterReader</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Operation</span><span class="w"> </span><span class="n">requires</span><span class="w"> </span><span class="n">crash</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">reboot</span><span class="p">,</span><span class="w"> </span><span class="n">but</span><span class="w"> </span><span class="n">opt</span><span class="o">-</span><span class="ow">in</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">specified</span><span class="o">.</span>
<span class="p">[</span><span class="o">!</span><span class="p">]</span><span class="w"> </span><span class="n">No</span><span class="w"> </span><span class="n">default</span><span class="w"> </span><span class="n">RegisterReader</span><span class="w"> </span><span class="n">available</span><span class="o">.</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">spinand</span><span class="w"> </span><span class="n">read</span><span class="p">:</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="c1"># 0, count 220672 ...</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Flash</span><span class="w"> </span><span class="n">read</span><span class="w"> </span><span class="n">into</span><span class="w"> </span><span class="n">RAM</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">usb</span><span class="w"> </span><span class="n">write</span><span class="w"> </span><span class="mh">0x61700000</span><span class="w"> </span><span class="mh">0x0</span><span class="w"> </span><span class="mh">0x35e00</span>

<span class="n">usb</span><span class="w"> </span><span class="n">write</span><span class="p">:</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="n">block</span><span class="w"> </span><span class="c1"># 0, count 220672 ...</span>
<span class="p">[</span><span class="o">+</span><span class="p">]</span><span class="w"> </span><span class="n">Flash</span><span class="w"> </span><span class="n">written</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">USB</span>
</code></pre></div>

<p>When we insert the USB stick into the Pi we see the following partitions:</p>
<div class="highlight"><pre><span></span><code><span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">scripts</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="n">lsblk</span>
<span class="n">NAME</span><span class="w">        </span><span class="nl">MAJ</span><span class="p">:</span><span class="nf">MIN</span><span class="w"> </span><span class="n">RM</span><span class="w">  </span><span class="k">SIZE</span><span class="w"> </span><span class="n">RO</span><span class="w"> </span><span class="n">TYPE</span><span class="w"> </span><span class="n">MOUNTPOINT</span>
<span class="n">sda</span><span class="w">           </span><span class="mi">8</span><span class="err">:</span><span class="mi">0</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="mf">57.8</span><span class="n">G</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="k">disk</span>
<span class="err">â”œâ”€</span><span class="n">sda1</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">1</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">4</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda2</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">2</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">2</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda3</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">3</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">9</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â”œâ”€</span><span class="n">sda4</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">4</span><span class="w">    </span><span class="mi">1</span><span class="w"> </span><span class="mf">80.8</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
<span class="err">â””â”€</span><span class="n">sda5</span><span class="w">        </span><span class="mi">8</span><span class="err">:</span><span class="mi">5</span><span class="w">    </span><span class="mi">1</span><span class="w">    </span><span class="mi">8</span><span class="n">M</span><span class="w">  </span><span class="mi">0</span><span class="w"> </span><span class="n">part</span>
</code></pre></div>

<p>Success! We have extracted the SPI flash to a USB device using Depthcharge!</p>
<h1>Filesystem Contents</h1>
<p>Now that we have a reliable way to read and write the flash, let's briefly examine the contents. The interesting files are located in the <code>/moo</code> folder. This folder contains the emulator and its relevant assets. Moo is a custom emulator that uses a custom ROM format; in 2020, some researchers <a href="https://www.synacktiv.com/ressources/sf30_r2con.pdf">did excellent work</a> on a different version of the emulator. If we look at the directory contents, however, there is something interesting that stands out:</p>
<div class="highlight"><pre><span></span><code><span class="nf">pi</span><span class="nv">@voidstar</span><span class="err">:</span><span class="o">~/</span><span class="n">marvel</span><span class="o">-</span><span class="n">cab</span><span class="o">/</span><span class="n">parts</span><span class="o">/</span><span class="n">squashfs</span><span class="o">-</span><span class="n">root</span><span class="o">/</span><span class="n">moo</span><span class="w"> </span><span class="err">$</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="o">*</span>
<span class="nl">docs</span><span class="p">:</span><span class="w">                              </span><span class="n">symbolic</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">..</span><span class="o">/</span><span class="n">userdata</span>
<span class="n">logo</span><span class="p">.</span><span class="nl">mp4</span><span class="p">:</span><span class="w">                          </span><span class="n">ISO</span><span class="w"> </span><span class="n">Media</span><span class="p">,</span><span class="w"> </span><span class="n">MP4</span><span class="w"> </span><span class="n">Base</span><span class="w"> </span><span class="n">Media</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">[</span><span class="n">IS0 14496-12:2003</span><span class="o">]</span>
<span class="nl">MOO</span><span class="p">:</span><span class="w">                               </span><span class="n">symbolic</span><span class="w"> </span><span class="n">link</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">MOO</span><span class="o">-</span><span class="n">Ship</span><span class="o">-</span><span class="n">MIME_CCADE_MSH_2P</span><span class="o">-</span><span class="n">BRK01</span>
<span class="n">MOO</span><span class="o">-</span><span class="n">Ship</span><span class="o">-</span><span class="n">MIME_CCADE_MSH_2P</span><span class="o">-</span><span class="nl">BRK01</span><span class="p">:</span><span class="w">  </span><span class="n">ELF</span><span class="w"> </span><span class="mi">32</span><span class="o">-</span><span class="nc">bit</span><span class="w"> </span><span class="n">LSB</span><span class="w"> </span><span class="n">executable</span><span class="p">,</span><span class="w"> </span><span class="n">ARM</span><span class="p">,</span><span class="w"> </span><span class="n">EABI5</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">SYSV</span><span class="p">),</span><span class="w"> </span><span class="n">dynamically</span><span class="w"> </span><span class="n">linked</span><span class="p">,</span><span class="w"> </span><span class="n">interpreter</span><span class="w"> </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">ld</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">armhf</span><span class="p">.</span><span class="n">so</span><span class="mf">.3</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">GNU</span><span class="o">/</span><span class="n">Linux</span><span class="w"> </span><span class="mf">4.4.0</span><span class="p">,</span><span class="w"> </span><span class="n">stripped</span>
<span class="n">SKUShell</span><span class="p">.</span><span class="n">MIME_CCADE_SF2_2P</span><span class="mf">.19</span><span class="p">.</span><span class="nl">exe</span><span class="p">:</span><span class="w"> </span><span class="n">PE32</span><span class="o">+</span><span class="w"> </span><span class="n">executable</span><span class="w"> </span><span class="p">(</span><span class="n">GUI</span><span class="p">)</span><span class="w"> </span><span class="n">x86</span><span class="o">-</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">MS</span><span class="w"> </span><span class="n">Windows</span>
<span class="k">start</span><span class="p">.</span><span class="nl">sh</span><span class="p">:</span><span class="w">                          </span><span class="n">POSIX</span><span class="w"> </span><span class="n">shell</span><span class="w"> </span><span class="n">script</span><span class="p">,</span><span class="w"> </span><span class="nf">ASCII</span><span class="w"> </span><span class="nc">text</span><span class="w"> </span><span class="n">executable</span>
<span class="nl">_ui</span><span class="p">:</span><span class="w">                               </span><span class="n">directory</span>
<span class="nl">zassets</span><span class="p">:</span><span class="w">                           </span><span class="n">directory</span>
</code></pre></div>

<p>Surely there couldn't be a PE32 Windows executable on this system, right? Well, if we copy this file onto a windows machine and attempt to execute it:</p>
<p><img alt="MOO Running" src="https://voidstarsec.com/blog/assets/images/windows.jpg" style="display:block; margin-left:auto; margin-right:auto"></p>
<p>It runs! Apparently, this was a build artifact that the author didn't realize was on the system; he reached out to me about it on Twitter, and we had a great conversation about reverse engineering/emulation.</p>
<p>With the methods outlined in this post, we can now read and write the SPI flash to and from a USB drive using UBoot. We have extracted the root filesystem and identified the core emulation components. Our next steps will be to reverse engineer some of the binaries on this target to determine how difficult it will be to run custom firmware.</p>
<h1>Conclusion / Next Steps</h1>
<p>With this blog entry, we reviewed how to perform an initial teardown of an embedded device and identify potential debug headers using our multimeters/logic analyzers. We then reviewed how to analyze unknown UART traffic and connect to a serial port using <code>screen</code> with a Raspberry Pi. After connecting to the serial port, we discovered that the UBoot console could be accessed by pressing <code>Ctrl-C</code>. After reviewing the UBoot console, we wrote a <a href="https://depthcharge.readthedocs.io/en/latest/">depthcharge</a> script to extract each SPI flash partition to an external flash drive. In our next post, we will take an in-depth look at the UBoot binary and learn how to create and modify memory maps using Ghidra; we will then attempt to flash a custom kernel to the device and see if we can install custom firmware. </p>
<p>All of the scripts and tools used can be found on <a href="https://github.com/wrongbaud/mvc-cab">github</a>.</p>
<p>Thank you for taking the time to read this; if you have any questions or comments, please feel to reach out to me <a href="https://twitter.com/wrongbaud">on Twitter</a>!</p>
<p>If this kind of work is interesting to you and you would like to learn more, consider <a href="https://voidstarsec.com/training.html">our hardware hacking bootcamp</a>. This is a five-day course that is offered remotely and on-site; all hardware is shipped to your door and is yours to keep after the course! See our <a href="https://voidstarsec.com/training.html">training page</a> for more details. <a href="http://eepurl.com/hSl31f">Our newsletter</a> is also a great way to stay informed on new courses, tools that we are using, blog posts, and upcoming course offerings. </p>
            </div>
            <!-- /.entry-content -->
        </article>
    </section>

        </div>
        <div class="col-sm-3 col-sm-pull-9" id="sidebar">
            <aside>
<!-- Sidebar -->
<section class="well well-sm">
  <ul class="list-group list-group-flush">

<!-- Sidebar/Social -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Social</span></h4>
  <ul class="list-group" id="social">
    <li class="list-group-item"><a href="http://twitter.com/voidstarsec"><i class="fa fa-twitter-square fa-lg"></i> twitter</a></li>
    <li class="list-group-item"><a href="http://www.linkedin.com/in/voidstarsec"><i class="fa fa-linkedin-square fa-lg"></i> linkedin</a></li>
    <li class="list-group-item"><a href="http://github.com/voidstarsec"><i class="fa fa-github-square fa-lg"></i> github</a></li>
  </ul>
</li>
<!-- End Sidebar/Social -->

<!-- Sidebar/Categories -->
<li class="list-group-item">
  <h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4>
  <ul class="list-group" id="categories">
    <li class="list-group-item">
      <a href="/category/ghidra.html"><i class="fa fa-folder-open fa-lg"></i>Ghidra</a>
    </li>
    <li class="list-group-item">
      <a href="/category/glitching.html"><i class="fa fa-folder-open fa-lg"></i>Glitching</a>
    </li>
    <li class="list-group-item">
      <a href="/category/hardware.html"><i class="fa fa-folder-open fa-lg"></i>Hardware</a>
    </li>
    <li class="list-group-item">
      <a href="/category/training.html"><i class="fa fa-folder-open fa-lg"></i>Training</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Categories -->

<!-- Sidebar/Links -->
<li class="list-group-item">
  <h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
  <ul class="list-group" id="links">
    <li class="list-group-item">
      <a href="https://voidstarsec.com/" target="_blank">VoidStar Security Website</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.voidstarsec.training/" target="_blank">VoidStar Security Training</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.voidstarsec.wiki/" target="_blank">Build a Hardware Hacking Lab</a>
    </li>
    <li class="list-group-item">
      <a href="https://hackaday.io/course/172292-introduction-to-reverse-engineering-with-ghidra" target="_blank">Free Ghidra Course</a>
    </li>
    <li class="list-group-item">
      <a href="https://www.wrongbaud.github.io/" target="_blank">Wrongbauds Blog (fun intro hacks)</a>
    </li>
  </ul>
</li>
<!-- End Sidebar/Links -->
  </ul>
</section>
<!-- End Sidebar -->            </aside>
        </div>
    </div>
</div>
<!-- End Content Container -->

<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2024 VoidStar Security
            &middot; Powered by <a href="https://github.com/getpelican/pelican-themes/tree/master/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="/theme/js/respond.min.js"></script>




</body>
</html>